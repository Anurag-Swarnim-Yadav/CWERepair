Original code,Plausible Program,Total Tokens,Sum Entropy,Mean Entropy
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (Stream_GetRemainingLength(s) >= 5) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } else { WLog_ERR ( TAG , ""Error: Invalid packet size"" ) ; } }",405,-12.011151006852097,-0.02965716297988172
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; 

WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; 

if (Stream_GetRemainingLength(s) < 7)
{
    WLog_ERR (TAG, ""Error: Unexpected end of data"");
    return;
}

Stream_Read_UINT8 ( s , flags ) ; 
Stream_Read_UINT16 ( s , length ) ; 
Stream_Read_UINT32 ( s , failureCode ) ; 

switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",425,-23.75506254940809,-0.055894264822136684
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_EnsureRemainingCapacity ( s , 6 ) if ( Stream_GetRemainingLength ( s ) < 6 ) return ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",398,-12.020997136798002,-0.03020351039396483
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (Stream_GetRemainingLength(s) < 1) { WLog_ERR ( TAG , ""Error: Invalid stream length."" ) ; nego -> state = NEGO_STATE_FAIL ; return; } Stream_Read_UINT8 ( s , flags ) ; if (Stream_GetRemainingLength(s) < 2) { WLog_ERR ( TAG , ""Error: Invalid stream length."" ) ; nego -> state = NEGO_STATE_FAIL ; return; } Stream_Read_UINT16 ( s , length ) ; if (Stream_GetRemainingLength(s) < 4) { WLog_ERR ( TAG , ""Error: Invalid stream length."" ) ; nego -> state = NEGO_STATE_FAIL ; return; } Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",516,-16.003390000122657,-0.031014321705664063
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (Stream_GetRemainingLength(s) >= 5) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } }",385,-5.692496010546448,-0.014785703923497269
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (Stream_GetRemainingLength(s) >= 5) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } else { WLog_ERR (TAG, ""Error: Stream is too short!""); } }",405,-12.704249398352095,-0.031368517032968134
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength ( s ) < 6 ) { WLog_ERR ( TAG , ""Error: Stream_GetRemainingLength ( s ) < 6"" ) ; return ; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",412,-9.776280202465278,-0.023728835442876888
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (!Stream_SafeSeek(s, 1)) { WLog_ERR(TAG, ""Error: Failed to seek to flags!""); return; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",403,-17.652304724047553,-0.043802244972822715
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength(s) < 7 )  return; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",386,-11.674878131499382,-0.030245798268133114
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if(Stream_GetRemainingLength(s) >= 6){ Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } else{ WLog_ERR (TAG, ""Error: Not enough data available for processing""); } }",405,-22.216927414298706,-0.05485661089950298
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength ( s ) < 6 ) { WLog_ERR ( TAG , ""Error: packet too small for RDP_NEG_FAILURE"" ) ; nego -> state = NEGO_STATE_FAIL ; return ; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",428,-16.293347738866782,-0.0380685694833336
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (Stream_GetRemainingLength(s) < 5) { WLog_ERR ( TAG , ""Error: Stream is too small for negotiation failure"" ) ; nego -> state = NEGO_STATE_FAIL ; return; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",422,-14.752542161179973,-0.03495863071369662
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if(Stream_GetRemainingLength(s) < 5) { WLog_ERR ( TAG , ""Error: Stream is too short"" ) ; nego -> state = NEGO_STATE_FAIL ; return; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",415,-19.715147977961216,-0.04750638066978606
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength(s) >= 5 ) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } }",385,-7.2908286698361415,-0.018937217324249717
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; 
// Check if the stream is long enough to read the values 
if ( Stream_GetRemainingLength ( s ) < 5 ) { WLog_ERR ( TAG , ""Error: Out-of-bounds read"" ) ; return ; } 
Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",426,-28.732664275962527,-0.06744756872291673
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { 
    BYTE flags ; 
    UINT16 length ; 
    UINT32 failureCode ; 
    WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; 
    if (Stream_GetRemainingLength(s) < 5) 
    {
        WLog_ERR(TAG, ""Error: Stream_GetRemainingLength(s) < 5"");
        nego->state = NEGO_STATE_FAIL;
        return;
    }
    Stream_Read_UINT8 ( s , flags ) ; 
    Stream_Read_UINT16 ( s , length ) ; 
    Stream_Read_UINT32 ( s , failureCode ) ; 
    switch ( failureCode ) { 
        case SSL_REQUIRED_BY_SERVER : 
            WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; 
            break ; 
        case SSL_NOT_ALLOWED_BY_SERVER : 
            WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; 
            nego -> sendNegoData = TRUE ; 
            break ; 
        case SSL_CERT_NOT_ON_SERVER : 
            WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; 
            nego -> sendNegoData = TRUE ; 
            break ; 
        case INCONSISTENT_FLAGS : 
            WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; 
            break ; 
        case HYBRID_REQUIRED_BY_SERVER : 
            WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; 
            break ; 
        default : 
            WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; 
            break ; 
    } 
    nego -> state = NEGO_STATE_FAIL ; 
}",529,-19.175878086457768,-0.03624929694982565
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength ( s ) >= 6 ) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } else { WLog_ERR ( TAG , ""Stream_GetRemainingLength(s) failed!"" ) ; } }",410,-13.663025491600253,-0.0333244524185372
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (&length < Stream_GetRemainingLength(s)) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } else { WLog_ERR ( TAG , ""Error: Out of bounds read."" ) ; } }",405,-27.491840001718142,-0.06788108642399542
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if(Stream_GetRemainingLength(s) >= 5) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } else { WLog_ERR (TAG, ""Error: Not enough data to process negotiation failure""); } }",407,-14.186431178503247,-0.03485609626167874
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; if (Stream_GetRemainingLength (s) >= 6) { WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } else { WLog_ERR ( TAG , ""Error: Not enough data in stream to read!""); } }",408,-25.75000960064271,-0.06311276862902625
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( !Stream_SafeRead_UINT8 ( s , &flags ) || !Stream_SafeRead_UINT16 ( s , &length ) || !Stream_SafeRead_UINT32 ( s , &failureCode ) ) { WLog_ERR ( TAG , ""Error reading from stream"" ) ; return ; } switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",401,-17.915591620162584,-0.04467728583581692
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (!Stream_SafeRead_UINT8(s, &flags)) return; if (!Stream_SafeRead_UINT16(s, &length)) return; if (!Stream_SafeRead_UINT32(s, &failureCode)) return; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",385,-8.488002498618313,-0.022046759736670942
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (Stream_GetRemainingLength (s) < 7) { WLog_ERR ( TAG , ""Error: Invalid packet length""); return; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",402,-14.486438820700124,-0.03603591746442817
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if(Stream_GetRemainingLength(s) < sizeof(BYTE) + sizeof(UINT16) + sizeof(UINT32)) { WLog_ERR ( TAG , ""Error: Invalid Stream length"" ) ; nego -> state = NEGO_STATE_FAIL ; return ; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",435,-19.35129255231611,-0.04448573000532439
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; 
if (length >= 4) {
  Stream_Read_UINT32 ( s , failureCode ) ; 
  switch ( failureCode ) { 
    case SSL_REQUIRED_BY_SERVER : 
      WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; 
      break ; 
    case SSL_NOT_ALLOWED_BY_SERVER : 
      WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; 
      nego -> sendNegoData = TRUE ; 
      break ; 
    case SSL_CERT_NOT_ON_SERVER : 
      WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; 
      nego -> sendNegoData = TRUE ; 
      break ; 
    case INCONSISTENT_FLAGS : 
      WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; 
      break ; 
    case HYBRID_REQUIRED_BY_SERVER : 
      WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; 
      break ; 
    default : 
      WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; 
      break ; 
  } 
  nego -> state = NEGO_STATE_FAIL ; 
 } 
}",454,-18.57754002785675,-0.04091969169131442
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength ( s ) < 5 ) { WLog_ERR ( TAG , ""Error: Stream_GetRemainingLength < 5"" ) ; nego -> state = NEGO_STATE_FAIL ; return ; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",423,-7.9839719862805385,-0.018874638265438625
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength ( s ) < 5 ) { WLog_ERR ( TAG , ""Error: insufficient data in Stream_Read_UINT8"" ) ; return ; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",411,-17.029975886705753,-0.04143546444453954
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength ( s ) < 5 ) { WLog_ERR ( TAG , ""Error: Stream_GetRemainingLength returned too small value"" ) ; nego -> state = NEGO_STATE_FAIL ; return ; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",425,-15.274401090488247,-0.035939767271737054
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (Stream_GetRemainingLength(s) >= 5) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } else { WLog_ERR ( TAG , ""Error: Stream does not contain enough data to process failure message"") ; } }",411,-22.321821242730046,-0.05431100059058405
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; 

if (Stream_GetRemainingLength(s) < 8) { WLog_ERR(TAG, ""Error: Stream too short!"");  return; }

Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",409,-22.70986392054376,-0.0555253396590312
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; if ( Stream_GetRemainingLength ( s ) < 7 ) { WLog_ERR ( TAG , ""Error: Out-of-bounds read while processing negotiation failure."" ) ; return ; }  WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",413,-22.429503778715347,-0.054308725856453625
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; if (length > Stream_GetRemainingLength(s)) { WLog_ERR(TAG, ""Error: Out-of-bounds read while processing NEGO_FAILURE.""); nego->state = NEGO_STATE_FAIL; return; } Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",429,-22.238542897460704,-0.051838095332076235
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; 
if ( Stream_GetRemainingLength ( s ) < 7 ) { WLog_ERR ( TAG , ""Error: Negotiation failure packet too small"" ) ; nego -> state = NEGO_STATE_FAIL ; return ; } 
Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",425,-19.995140661681734,-0.047047389792192314
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength ( s ) < 5 ) { WLog_ERR ( TAG , ""Error: Stream_GetRemainingLength(s) < 5"" ) ; nego -> state = NEGO_STATE_FAIL ; return ; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",426,-8.110072780610215,-0.019037729531948863
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if(Stream_GetRemainingLength(s) < 1)
		return;
		
Stream_Read_UINT8 ( s , flags ) ; 

if(Stream_GetRemainingLength(s) < 2)
		return;
		
Stream_Read_UINT16 ( s , length ) ; 

if(Stream_GetRemainingLength(s) < 4)
		return;

Stream_Read_UINT32 ( s , failureCode ) ; 

switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",445,-22.150732172885004,-0.04977692623120226
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength ( s ) >= 7 ) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } else { WLog_ERR ( TAG , ""Error: Out-of-bounds read when attempting to read negotiation failure code!"" ) ; } }",416,-20.3984485732162,-0.04903473214715433
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength ( s ) < 7 ) { WLog_ERR ( TAG , ""Error: Out-of-bounds read detected!"" ) ; return ; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",409,-9.549683802602953,-0.023348860153063453
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength ( s ) < 7 ) { WLog_ERR ( TAG , ""Error: Invalid negotiation failure packet."" ) ; return ; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",405,-12.429800654761332,-0.03069086581422551
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; 
	// Verify length of Stream before processing
	if (Stream_GetRemainingLength(s) < 8) {
		WLog_ERR(TAG, ""Error: Stream length too short"");
		nego -> state = NEGO_STATE_FAIL;
		return;
	}

	WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; 
	Stream_Read_UINT8 ( s , flags ) ;
	Stream_Read_UINT16 ( s , length ) ; 
	Stream_Read_UINT32 ( s , failureCode ) ; 
	switch ( failureCode ) {
		case SSL_REQUIRED_BY_SERVER :
			WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; 
			break ; 
		case SSL_NOT_ALLOWED_BY_SERVER : 
			WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; 
			nego -> sendNegoData = TRUE ; 
			break ; 
		case SSL_CERT_NOT_ON_SERVER : 
			WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; 
			nego -> sendNegoData = TRUE ; 
			break ; 
		case INCONSISTENT_FLAGS : 
			WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; 
			break ; 
		case HYBRID_REQUIRED_BY_SERVER : 
			WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; 
			break ; 
		default : 
			WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; 
			break ; 
	}
	
	nego -> state = NEGO_STATE_FAIL ; 
}",554,-56.06976716016346,-0.10120896599307483
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) {
  BYTE flags ; 
  UINT16 length ; 
  UINT32 failureCode ; 
  WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; 

  if (Stream_GetRemainingLength(s) >= 5) {
    Stream_Read_UINT8 ( s , flags ) ; 
    Stream_Read_UINT16 ( s , length ) ; 
    Stream_Read_UINT32 ( s , failureCode ) ; 

    switch ( failureCode ) { 
      case SSL_REQUIRED_BY_SERVER : 
        WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; 
        break ; 
      case SSL_NOT_ALLOWED_BY_SERVER : 
        WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; 
        nego -> sendNegoData = TRUE ; 
        break ; 
      case SSL_CERT_NOT_ON_SERVER : 
        WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; 
        nego -> sendNegoData = TRUE ; 
        break ; 
      case INCONSISTENT_FLAGS : 
        WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; 
        break ; 
      case HYBRID_REQUIRED_BY_SERVER : 
        WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; 
        break ; 
      default : 
        WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; 
        break ; 
    } 
    nego -> state = NEGO_STATE_FAIL ; 
  }
}",480,-17.106070381091065,-0.035637646627273055
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; if (Stream_GetRemainingLength(s) < 8) { WLog_ERR ( TAG , ""Error: Out-of-bounds read detected."" ) ; nego -> state = NEGO_STATE_FAIL ; return ; } WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",423,-15.008350516502194,-0.03548073408156547
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (Stream_GetRemainingLength(s) >= 5) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } else { WLog_ERR(TAG, ""Error: Out-of-bounds read.""); nego->state = NEGO_STATE_FAIL; } 
}",424,-17.85451347314334,-0.042109701587602216
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (!Stream_SafeRead_UINT8(s, &flags) || !Stream_SafeRead_UINT16(s, &length) || !Stream_SafeRead_UINT32(s, &failureCode)) { WLog_ERR(TAG, ""Failed to read negotiation failure message""); nego->state = NEGO_STATE_FAIL; return; } switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",414,-13.408720311720945,-0.03238821331333561
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; Stream_EnsureRemainingCapacity ( s , 5 ) ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",383,-9.146962042557531,-0.02388240742182123
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; if ( length >= 4 ) { Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } else { WLog_ERR ( TAG , ""Error: Negotiation failure message length is too small"" ) ; nego -> state = NEGO_STATE_FAIL ; } }",416,-19.391349148622332,-0.046613820068803685
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (Stream_GetRemainingLength (s) < 7) { WLog_ERR(TAG, ""Error: Invalid data size!""); nego->state = NEGO_STATE_FAIL; return; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",417,-16.792842846050792,-0.04027060634544555
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if ( Stream_GetRemainingLength ( s ) < 5 ) { WLog_ERR ( TAG , ""RDP_NEG_FAILURE packet is too short: actual %"" PRIuz "", expected 5"" , Stream_GetRemainingLength ( s ) ) ; nego -> state = NEGO_STATE_FAIL ; return ; } Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",446,-16.374837774458207,-0.03671488290237266
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (Stream_GetRemainingLength(s) >= 5) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; } else { WLog_ERR (TAG, ""Error: Out of range read request!""); return; } switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }",408,-24.89904985327156,-0.0610270829737048
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; if (Stream_GetRemainingLength(s) >= 5) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } else { WLog_ERR ( TAG , ""Error: Stream is too short to read data."" ) ; } }",409,-14.546845515869745,-0.03556685945200427
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; }
Fixed code:","
void nego_process_negotiation_failure ( rdpNego * nego , wStream * s ) { BYTE flags ; UINT16 length ; UINT32 failureCode ; WLog_DBG ( TAG , ""RDP_NEG_FAILURE"" ) ; //Check if the stream is read beyond its length if (Stream_GetRemainingLength ( s) >= 5) { Stream_Read_UINT8 ( s , flags ) ; Stream_Read_UINT16 ( s , length ) ; Stream_Read_UINT32 ( s , failureCode ) ; switch ( failureCode ) { case SSL_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_REQUIRED_BY_SERVER"" ) ; break ; case SSL_NOT_ALLOWED_BY_SERVER : WLog_WARN ( TAG , ""Error: SSL_NOT_ALLOWED_BY_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case SSL_CERT_NOT_ON_SERVER : WLog_ERR ( TAG , ""Error: SSL_CERT_NOT_ON_SERVER"" ) ; nego -> sendNegoData = TRUE ; break ; case INCONSISTENT_FLAGS : WLog_ERR ( TAG , ""Error: INCONSISTENT_FLAGS"" ) ; break ; case HYBRID_REQUIRED_BY_SERVER : WLog_WARN ( TAG , ""Error: HYBRID_REQUIRED_BY_SERVER"" ) ; break ; default : WLog_ERR ( TAG , ""Error: Unknown protocol security error %"" PRIu32 """" , failureCode ) ; break ; } nego -> state = NEGO_STATE_FAIL ; } }",395,-33.7067134041992,-0.0853334516562005
