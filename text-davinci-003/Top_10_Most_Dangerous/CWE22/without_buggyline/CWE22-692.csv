Original code,Plausible Program,Total Tokens,Sum Entropy,Mean Entropy
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (strncmp(remote_dev->dev_group.cg_item.ci_name, ""/dev/"", 5) != 0) { pr_err(""Invalid parameter\n""); return; } pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } 
The fixed code adds a check to ensure that the pathname is not longer than 5 characters and starts with ""/dev/"", thus limiting the directory to be a restricted directory.",236,-56.923274269751786,-0.24120031470233808
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if(strncmp(remote_dev->dev_group, "".."",2) != 0) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } else { pr_info(""Path traversal detected. Filtering out..\n""); } }",197,-38.0227822830404,-0.19300904712203248
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if ( strstr ( & remote_dev -> dev_group . cg_item , ""../"" ) == NULL ) { pr_debug ( ""Calling configfs_undepend_item for remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",180,-16.774234945373202,-0.09319019414096223
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; if (remote_dev != NULL && & remote_dev->dev_group != NULL) { target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",175,-13.931333308147902,-0.0796076189037023
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { const char * restrict_dir = ""/dst/remote_dev""; struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; char * absolute_path = realpath(restrict_dir, NULL); if (absolute_path) { if (strncmp(restrict_dir, absolute_path, strlen(restrict_dir)) == 0) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } } free(absolute_path); }",227,-42.22170938330806,-0.18599871975025578
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (strcmp(xop->src_dev, xop->dst_dev) != 0) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",179,-13.179645110696997,-0.07362930229439663
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (remote_dev != NULL && strlen(remote_dev->dev_group.cg_item) > 0) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",183,-10.718243469899202,-0.05856963644753662
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; if (!strncmp(remote_dev->dev_group.cg_item.ci_name, ""."", PATH_MAX) || 
!strncmp(remote_dev->dev_group.cg_item.ci_name, "".."", PATH_MAX)) {
 return;
}
target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",222,-25.508499119166498,-0.11490314918543468
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; char * dev_path = realpath(remote_dev -> dev_group . cg_item, NULL); pr_debug ( ""Calling configfs_undepend_item for remote_dev: %p remote_dev->dev_group: %s\\n"" , remote_dev , dev_path ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; free(dev_path); }",172,-21.902390902048694,-0.1273394819886552
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; if (strstr(remote_dev -> dev_group . cg_item, '..') == NULL) { target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",180,-12.292088956909897,-0.06828938309394388
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; 

if (remote_dev != NULL) {
  pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ;
  target_undepend_item ( & remote_dev -> dev_group . cg_item ) ;
}
}",173,-13.466234538465496,-0.07783950600269073
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (remote_dev != NULL && strncmp(remote_dev->dev_group.cg_item.ci_name, ""/dev/"", 5) == 0) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",194,-12.8949579038739,-0.06646885517460774
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; 

if (remote_dev) {
	if (remote_dev->dev_group) {
		target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; 
	}
}
}",187,-19.6204672038047,-0.1049222845123246
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (!strncmp(remote_dev->dev_group.cg_item.ci_name, ""/dev/"", 5)) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } else { //Handle Error } }",191,-20.403400423606904,-0.1068240859874707
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; char canonical_path[PATH_MAX]; realpath(remote_dev->dev_group.cg_item, canonical_path); pr_debug ( ""Calling configfs_undepend_item for"" ""remote_dev: %p remote_dev->dev_group: %s\\n"" , remote_dev , canonical_path ) ; target_undepend_item ( canonical_path ) ; }",163,-18.5802757714117,-0.11398942191050122
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if ( remote_dev ) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",162,-6.7573083223869,-0.041711779767820374
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; // validate the remote_dev path before de-referencing it if ( validate_remote_dev_path ( remote_dev ) ) return ; }",185,-33.4266003227609,-0.18068432606897783
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (remote_dev) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",162,-6.537964647613103,-0.04035780646674755
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; char path[PATH_MAX] = """"; if(realpath(remote_dev -> dev_group.cg_item.ci_name, path) == NULL){ perror(""realpath()""); return; } if(strncmp(path, ""/"", 1)){ perror(""Invalid path""); return; } pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",223,-41.63129761743614,-0.18668743326204548
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (strstr(remote_dev->dev_group.cg_item, "".."") == NULL){ pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",179,-10.041822969812904,-0.05609956966375924
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (remote_dev->dev_group.cg_item.ci_type == CFTYPE_PATH)  { if(strncmp(remote_dev->dev_group.cg_item.ci_dentry->d_iname, "".."", 2) != 0) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } } }",222,-26.345563467120595,-0.11867370931135403
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:"," 
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; if ( strstr( remote_dev -> dev_group . cg_item , ""../"" ) != NULL ) { pr_debug ( ""Path traversal detected. Aborting"" "" call to target_undepend_item.\\n"" ) ; return ; } }",212,-39.902696524788404,-0.1882202666263604
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (remote_dev != NULL && remote_dev->dev_group != NULL) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",174,-6.984028317031104,-0.04013809377604083
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; char path_buf [ MAX_PATH_LEN ] ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; snprintf ( path_buf , sizeof ( path_buf ) , ""%s/%s"" , CONFIGFS_DIR , remote_dev -> dev_group . cg_item .ci_name ) ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %s\\n"" , remote_dev , path_buf ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",201,-19.335781688529117,-0.09619791884840356
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; const char * dir = ""/var/target/pr/""; char path[PATH_MAX]; if (realpath(dir, path) == NULL) { // Handle error here. } else { strncat(path, & remote_dev -> dev_group . cg_item, PATH_MAX - strlen(path)); pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & path ) ; target_undepend_item ( & path ) ; } }",203,-48.45698535259739,-0.2387043613428443
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (remote_dev->dev_group.cg_item.ci_parent == &target_core_cg_item){ pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",184,-18.3734557134394,-0.09985573757304023
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; if (xop->op_origin != XCOL_SOURCE_RECV_OP && xop->op_origin != XCOL_DEST_RECV_OP) { return; } target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",195,-11.790801744338108,-0.06046564997096465
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; const char * path = remote_dev -> dev_group . cg_item ; if (strstr(path, "".."") == NULL) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } else { printf(""Error: Path traversal detected\n""); } }",201,-22.281700423402448,-0.11085423096220123
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; // Add check to ensure that the item is in the expected directory if ( strncmp ( remote_dev -> dev_group . cg_item . ci_path , ""/etc/xdg/remote_dev"" , strlen ( ""/etc/xdg/remote_dev"" ) ) != 0 ) { return ; } target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",224,-42.0016121594991,-0.187507197140621
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; const char * restricted_path = ""/target_pt/configfs""; if (strncmp(remote_dev->dev_group.cg_item.ci_name, restricted_path, strlen(restricted_path)) == 0) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } else { pr_debug(""Path is outside of the restricted directory, cannot be used.""); } }",228,-50.47527240904839,-0.22138277372389642
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; // Validate the path traversal if (!xcopy_check_path_traversal(&remote_dev->dev_group.cg_item) { return; } target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }

// And include the additional function
static int xcopy_check_path_traversal(struct config_item *cg_item) { const char *prefix = ""/sys/kernel/config/""; const char *item_path = config_item_name(cg_item); if (strncmp(prefix, item_path, strlen(prefix)) != 0) { return 0; } else { return 1; } }",287,-80.89552372635319,-0.2818659363287568
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (remote_dev != NULL && remote_dev->dev_group != NULL && remote_dev->dev_group.cg_item != NULL) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",189,-9.498572222404906,-0.050256995885740244
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; if (strncmp(remote_dev->dev_group.cg_item, ""../"", 3) == 0) { pr_err(""Path traversal detected in config item.\n""); return; } target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",200,-26.868640804538693,-0.13434320402269345
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (!remote_dev) return; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",162,-6.932011815076498,-0.0427901963893611
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; // Check if path is valid before calling target_undepend_item. if(checkPathTraversal(& remote_dev -> dev_group . cg_item ) == 0) { target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } //else print error and exit } // checkPathTraversal static int checkPathTraversal(const char *path) { //Check if path contains "".."" or absolute path if(strstr(path, "".."") || path[0] == '/') { //print error and return -1 fprintf(stderr, ""[Error] Path Traversal detected\n""); return -1; } return 0; }",285,-103.23872549817908,-0.362241142098874
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; if ( strncmp(remote_dev->dev_group.cg_item, ""/restricted/path"", strlen(""/restricted/path"")) ) { return; } else { target_undepend_item ( & remote_dev -> dev_group . cg_item ) ;  } }",195,-31.138645124665395,-0.1596853596136687
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (strncmp(remote_dev->dev_group.cg_item, "".."", 2) != 0) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",183,-9.978522996049616,-0.0545274480658449
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; if (strncmp(remote_dev->dev_group.cg_item.cg_item_path, expected_path, MAX_LEN) == 0) { target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } else { pr_err(""Error: Path provided is not the expected path. Aborting""); return; } }",216,-44.798146398225,-0.20739882591770833
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","

static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { 
    struct se_device * remote_dev ; 
    if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) 
        remote_dev = xop -> dst_dev ; 
    else 
        remote_dev = xop -> src_dev ; 
    if (remote_dev && strcmp(remote_dev->dev_group.cg_item.ci_name, """") != 0) {
        pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; 
        target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; 
    }
}",215,-18.875031211561133,-0.08779084284447039
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if(strstr(remote_dev -> dev_group.cg_item, "".."") == NULL) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",180,-11.404342395370605,-0.06335745775205892
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; /*Validate the path before using it */ if (strstr(remote_dev, "".."") == 0) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",180,-26.72591773467972,-0.14847732074822065
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (remote_dev && remote_dev->dev_group) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } else { printk(KERN_ERR ""Path traversal error.\n""); } }",190,-21.2222432876609,-0.11169601730347842
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; const char * device_group ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; device_group = basename(remote_dev->dev_group); if (strchr(device_group, '/')) { fprintf(stderr, ""Error: Traversal detected\n""); return; } pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",210,-40.564595997550974,-0.19316474284548082
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; if (!strncmp(&remote_dev->dev_group.cg_item,'/',1)) { target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } else { pr_debug(""Invalid path detected! Skipping path traversal vulnerability.""); } }",198,-35.3506518892917,-0.17853864590551363
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; //Check for valid pathname input char * const pattern = ""^[a-zA-Z0-9_/.-]+$""; regex_t regex; int result; result = regcomp(&regex, pattern, 0); if (result != 0) { fprintf(stderr, ""Could not compile regex\n""); exit(1); } result = regexec(&regex, remote_dev->dev_group.cg_item, 0, NULL, 0); if (result != 0) { fprintf(stderr, ""Invalid pathname\n""); exit(1); } pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; regfree(&regex); }",290,-60.89260420311662,-0.20997449725212627
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (strstr(remote_dev -> dev_group.cg_item, "".."") == NULL) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } else {printf(""Path Traversal is not allowed."");} }",194,-24.705612804664504,-0.1273485196116727
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if(xop->dst_dev == NULL || xop->src_dev == NULL) return; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",177,-12.716890443283404,-0.0718468386626181
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if(remote_dev != NULL && strlen(remote_dev->dev_group) < MAX_PATH) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",180,-16.199087427273046,-0.08999493015151692
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; 
if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) {
	if (strncmp(xop->dst_dev, "".."", 2) != 0) {
		remote_dev = xop -> dst_dev ;
	} else {
		pr_debug(""Unable to traverse directory.\n"");
		return;
	}
} else {
	if (strncmp(xop->src_dev, "".."", 2) != 0) {
		remote_dev = xop -> src_dev ;
	} else {
		pr_debug(""Unable to traverse directory.\n"");
		return;
	}
} 

pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",278,-34.304984290521205,-0.12339922406662304
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { char * dir = ""/proc/configfs/""; char path[PATH_MAX]; struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; snprintf(path, sizeof(path), ""%s/%s"", dir, remote_dev -> dev_group . cg_item); pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %s\\n"" , remote_dev , path ) ; target_undepend_item ( path ) ; }",178,-28.305566341776917,-0.15902003562796022
