Original code,Plausible Program,Number of Bugs Present,Total Tokens,Sum Entropy,Mean Entropy
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) { if (xop->dst_dev && xop->dst_dev->dev_group) { remote_dev = xop -> dst_dev ; } else { return; } } else { if (xop->src_dev && xop->src_dev->dev_group) { remote_dev = xop -> src_dev ; } else { return; } } <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,222,-14.376060756391295,-0.06475703043419502
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; if ( xop -> dst_dev != NULL ) { <EndBug> else <StartBug> remote_dev = xop -> src_dev ; if ( xop -> src_dev != NULL ) { <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } } }",3,204,-12.860629973740812,-0.06304230379284712
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; 
if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) {
if (strncmp(xop->dst_dev, "".."", MAX_PATH_LEN) == 0) {
return;
}
remote_dev = xop -> dst_dev ; 
} else {
if (strncmp(xop->src_dev, "".."", MAX_PATH_LEN) == 0) {
return;
}
remote_dev = xop -> src_dev ; 
}
pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,234,-22.499157489651694,-0.09615024568227219
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; char * abs_path = realpath (& remote_dev -> dev_group . cg_item ,NULL); if (abs_path == NULL){ //Error handling } else { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; free (abs_path); } }",3,199,-41.06601300635321,-0.20636187440378498
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; DIR * dir ; char path [ PATH_MAX ] ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> snprintf ( path , PATH_MAX , ""/sys/kernel/config/target/%s"" , remote_dev -> dev_name ) ; if ( ! ( dir = opendir ( path ) ) ) { perror ( ""opendir"" ) ; return ; } pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; closedir ( dir ) ; }",3,256,-24.637962120517383,-0.09624203953327103
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char * pathname_prefix ; int len ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pathname_prefix = remote_dev -> dev_group . cg_item . ci_path ; len = strlen ( pathname_prefix ) ; if ( pathname_prefix [ len - 1 ] == '/' ) pathname_prefix [ len - 1 ] = '\0' ; if ( strncmp ( pathname_prefix , ""/config/"", 8 ) != 0 ) { pr_err ( ""remote_dev path: %s exceeds"" "" '/config/' directory\\n"" , pathname_prefix ) ; return ; } else { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",3,309,-59.14273838070828,-0.1914004478340074
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char * path_alloc ; /* allocated buffer to store the path */ <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; path_alloc = kzalloc(PATH_MAX+1, GFP_KERNEL); /* creating the buffer*/ <EndBug> else <StartBug> remote_dev = xop -> src_dev ; path_alloc = kzalloc(PATH_MAX+1, GFP_KERNEL); /* creating the buffer*/ <EndBug> realpath(& remote_dev -> dev_group . cg_item, path_alloc); /* Getting the absolute path */ pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %s\\n"" , remote_dev , path_alloc ) ; /* Using the absolute path instead of the relative path */ target_undepend_item ( path_alloc) ; kfree(path_alloc); /* Freeing the allocated buffer */ }",3,275,-97.23567346036145,-0.3535842671285871
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if(remote_dev && remote_dev->dev_group) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",3,170,-10.3504877400795,-0.06088522200046764
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) { struct se_device * remote_dev =  xop -> dst_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } else { struct se_device * remote_dev =  xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } <EndBug> }",3,246,-15.821046758707107,-0.06431319820612645
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:"," 
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; <EndBug> if (remote_dev) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",3,171,-10.344661842662603,-0.06049509849510294
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; 
if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) { remote_dev = xop -> dst_dev ; } else { remote_dev = xop -> src_dev ; } 

if (strncmp(remote_dev->dev_group.cg_item.ci_name, ""/"", 1) != 0) {
  pr_err(""Invalid remote device path %s\n"", remote_dev->dev_group.cg_item.ci_name);
  return;
}

pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,234,-31.06880201653549,-0.1327726581903226
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char * dev_group_path ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; dev_group_path = realpath ( remote_dev -> dev_group . cg_item . ci_group_path , NULL ) ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; dev_group_path = realpath ( remote_dev -> dev_group . cg_item . ci_group_path , NULL ) ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %s\\n"" , remote_dev , dev_group_path ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; free ( dev_group_path ) ; }",3,251,-15.112901929880604,-0.0602107646608789
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char * remote_device_name ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; remote_device_name = strdup(remote_dev->dev_name); if (remote_device_name == NULL) { perror(""strdup""); exit(1); } <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item , remote_device_name ) ; free(remote_device_name); }",3,241,-32.024298483791604,-0.1328809065717494
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,162,-5.554079027423649,-0.03428443844088672
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; <StartBug> char absolute_path[PATH_MAX + 1]; realpath(xop->dst_dev->dev_group.cg_item.ci_name, absolute_path); if (strncmp(absolute_path, ""/sys/kernel/config/target"", strlen(""/sys/kernel/config/target"")) != 0) { return; } <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,239,-27.08013599955042,-0.11330600836631975
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char pathname[MAX_PATH_SIZE] ; size_t pathname_len ; pathname_len = snprintf(pathname, MAX_PATH_SIZE, ""%s/%s"", xop->dst_dev->dev_group.cg_item.ci_group.cg_item.ci_dentry->d_iname, xop->dst_dev->dev_group.cg_item.ci_dentry->d_iname); if(pathname_len >= MAX_PATH_SIZE) { return ; } <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item , pathname) ; }",3,303,-45.84687991332289,-0.15130983469743528
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char path[PATH_MAX] ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; snprintf(path, sizeof(path), ""%s/%s"", CONFIGFS_DIRECTORY, remote_dev->dev_name); realpath(path, path); if (strncmp(path, CONFIGFS_DIRECTORY, strlen(CONFIGFS_DIRECTORY)) != 0) { return; } <EndBug> else <StartBug> remote_dev = xop -> src_dev ; snprintf(path, sizeof(path), ""%s/%s"", CONFIGFS_DIRECTORY, remote_dev->dev_name); realpath(path, path); if (strncmp(path, CONFIGFS_DIRECTORY, strlen(CONFIGFS_DIRECTORY)) != 0) { return; } <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,326,-27.90411361487098,-0.08559544053641405
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char pathname[PATH_MAX];<EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> snprintf(pathname, PATH_MAX, ""%s/%s"", xop->dst_dev->se_hba->hba_groups_store_path, xop->dst_dev->se_dev_su_ptr->t10_wwn.unit_serial) ; remote_dev = xop->dst_dev; <EndBug> else <StartBug> snprintf(pathname, PATH_MAX, ""%s/%s"", xop->src_dev->se_hba->hba_groups_store_path, xop->src_dev->se_dev_su_ptr->t10_wwn.unit_serial) ; remote_dev = xop->src_dev; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p, pathname: %s\\n"" , remote_dev , & remote_dev -> dev_group . cg_item , pathname ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,324,-45.417185172618105,-0.1401764974463522
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","

static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char * remote_dev_path; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> remote_dev_path = realpath(remote_dev, NULL); // Get the real path of the remote_dev 
if (remote_dev_path == NULL) { // Check for errors 
perror(""Error getting realpath of remote_dev""); 
return; 
} 
pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev_path: %s\\n"" , remote_dev , remote_dev_path ) ; target_undepend_item ( & remote_dev_path ) ; free(remote_dev_path); // Free memory of the realpath }",3,250,-56.534807299087824,-0.2261392291963513
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char* absolute_path = realpath(xop -> dst_dev, NULL); if (absolute_path == NULL) { // check return value from realpath fprintf(stderr, ""Error: Invalid path!""); return EXIT_FAILURE; } <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = absolute_path ; <EndBug> else <StartBug> remote_dev = absolute_path ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,229,-51.12330979265359,-0.22324589429106373
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (strncmp(remote_dev->dev_group.cg_item.ci_name, xop->allowed_dirs, MAX_DIR_PATH) == 0) { <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } <StartBug> else { printf(""Directory not allowed""); } <EndBug> }",3,221,-37.15795978772879,-0.16813556465035653
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char remote_dev_path [ MAX_PATH_NAME ] ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; snprintf ( remote_dev_path , MAX_PATH_NAME , ""/sys/kernel/config/target/%s"" , remote_dev -> dev_name ) ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; snprintf ( remote_dev_path , MAX_PATH_NAME , ""/sys/kernel/config/target/%s"" , remote_dev -> dev_name ) ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev_path , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( remote_dev_path , & remote_dev -> dev_group . cg_item ) ; }",3,274,-21.544215025803975,-0.0786285219919853
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> char * remote_dev_path ; struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> remote_dev_path = configfs_get_dev_path ( & remote_dev -> dev_group . cg_item ) ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev_path: %s\\n"" , remote_dev , remote_dev_path ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,206,-20.939123697013713,-0.10164623153890152
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> if (xop->dst_dev != NULL) { remote_dev = xop -> dst_dev ; } <EndBug> else <StartBug> if (xop->src_dev != NULL) { remote_dev = xop -> src_dev ; } <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,205,-9.880141579317696,-0.04819581258203754
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char* remote_dev_str = NULL; <EndBug> 
if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> 

remote_dev_str = strdup(remote_dev);
if (!remote_dev_str) {
    return;
}
if (strlen(remote_dev_str) > MAX_PATH_LENGTH) {
    free(remote_dev_str);
    return;
}
pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; free(remote_dev_str); }",3,269,-39.420669108302405,-0.14654523832082678
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; 

if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) {
	remote_dev = xop -> dst_dev ; 
} else { 
	remote_dev = xop -> src_dev; 
} <EndBug> 

pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; 
target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,183,-25.149101101539898,-0.13742678197562785
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char device_path [ MAX_PATH_LEN ] = { 0 } ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; snprintf ( device_path , MAX_PATH_LEN , ""%s%s/"" , CONFIGFS_DEP_DIR , remote_dev -> dev_group . cg_item .ci_name ) ; if ( strncmp ( xop -> src_dev -> cg_item .ci_name , device_path , strlen ( device_path ) ) ) { pr_err ( ""src_dev: %s, device_path: %s\\n"" , xop -> src_dev -> cg_item .ci_name , device_path ) ; return - EINVAL ; } <EndBug> else <StartBug> remote_dev = xop -> src_dev ; snprintf ( device_path , MAX_PATH_LEN , ""%s%s/"" , CONFIGFS_DEP_DIR , remote_dev -> dev_group . cg_item .ci_name ) ; if ( strncmp ( xop -> dst_dev -> cg_item .ci_name , device_path , strlen ( device_path ) ) ) { pr_err ( ""dst_dev: %s, device_path: %s\\n"" , xop -> dst_dev -> cg_item .ci_name , device_path ) ; return - EINVAL ; } <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,458,-64.69179242591626,-0.1412484550784198
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; if (remote_dev && remote_dev->dev_group) { <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",3,194,-11.708285445834257,-0.0603519868341972
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,162,-5.875894732679948,-0.03627095513999968
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; const char * pathname = """"; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; pathname = xop->dst_dev->dev_group.cg_item.ci_name; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; pathname = xop->src_dev->dev_group.cg_item.ci_name; <EndBug> // verify pathname is within restricted directory if (strncmp(pathname, ""/dev/"", 5) != 0) return; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,261,-40.15398707728038,-0.15384669378268342
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) { if (!strncmp(xop->dst_dev, '../', 3)) { return -EINVAL; } else { remote_dev = xop->dst_dev; } } else { if (!strncmp(xop->src_dev, '../', 3)) { return -EINVAL; } else { remote_dev = xop->src_dev; } } pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,218,-19.803199350125798,-0.09084036399140274
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char path[PATH_MAX];<EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; if (realpath(remote_dev->dev_group.cg_item, path) == NULL) { perror(""realpath""); return; }<EndBug> else <StartBug> remote_dev = xop -> src_dev ; if (realpath(remote_dev->dev_group.cg_item, path) == NULL) { perror(""realpath""); return; }<EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( path ) ; }",3,239,-21.726365999609637,-0.09090529706949639
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","

static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char * absolute_pathname = realpath(xop->src_dev->dev_group.cg_item.ci_group.cg_item.ci_dentry->d_iname, NULL);<EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = realpath(xop->dst_dev->dev_group.cg_item.ci_group.cg_item.ci_dentry->d_iname, absolute_pathname); <EndBug> else <StartBug> remote_dev = realpath(xop->src_dev->dev_group.cg_item.ci_group.cg_item.ci_dentry->d_iname, absolute_pathname); <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,299,-32.3163173855033,-0.10808132904850601
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char * remote_dev_group_path ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> remote_dev_group_path = g_strdup_printf ( ""%s/%s"" , CONFIGFS_DEV_IDX , remote_dev -> dev_group . cg_item . ci_name ) ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %s\\n"" , remote_dev , remote_dev_group_path ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; g_free ( remote_dev_group_path ) ; }",3,245,-38.4098904392354,-0.15677506301728733
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev = NULL ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> if (remote_dev) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } <StartBug> else { pr_debug(""No valid remote_dev found.\\n""); } <EndBug> }",3,213,-19.118963345305,-0.08976039129251175
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char *dev_name; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) 
<StartBug> dev_name =  xop->dst_dev->dev_name; remote_dev =  se_dev_get_by_name(dev_name); <EndBug> 
else 
<StartBug> dev_name =  xop->src_dev->dev_name; remote_dev =  se_dev_get_by_name(dev_name); <EndBug> 
pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,241,-36.46970957630366,-0.15132659575229734
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> char * dest = NULL; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> dest = xop -> dst_dev ; <EndBug> else <StartBug> dest = xop -> src_dev ; <EndBug> if ( strstr ( dest , "".."" ) == NULL ) { struct se_device * remote_dev ; remote_dev = dest ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } else { pr_debug ( ""Error: Path traversal detected!"" ) ; } }",3,219,-35.4983727205421,-0.1620930261211968
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if ( ! remote_dev ) return ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,163,-6.5300768176887996,-0.04006182096741595
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char absolute_path[PATH_MAX]; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> if (realpath(remote_dev->dev_group.cg_item, absolute_path) != NULL) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %s\\n"" , remote_dev , absolute_path ) ; target_undepend_item ( absolute_path ) ; } else { pr_err(""Error getting absolute path!""); } }",3,207,-27.163829163793405,-0.1312262278444126
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char full_path [MAX_PATH_LEN] ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> snprintf ( full_path , sizeof ( full_path ) , ""%s/%s"" , CONFIGFS_DEP_PATH , remote_dev -> dev_group . cg_item . ci_name ) ; pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , full_path ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,228,-29.27154856473899,-0.12838398493306574
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { 
struct se_device * remote_dev ;
if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) 
remote_dev = xop -> dst_dev ;
else
remote_dev = xop -> src_dev ;

if(strncmp(remote_dev, ""../"", 3) == 0 ||
 strncmp(remote_dev, ""/"", 1) == 0)
 {
  return;
 }

pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; 
target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,209,-38.97241212282622,-0.1864708714010824
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if (strncmp(remote_dev->dev_group.cg_item, ""/dev"", 4) != 0) { <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",3,191,-20.418311962369494,-0.10690215687104447
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:"," 
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char full_path_name [ PATH_MAX ] ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> if ( realpath ( remote_dev -> dev_group . cg_item , full_path_name ) == NULL ) { perror ( ""realpath"" ) ; return ; } pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %s\\n"" , remote_dev , full_path_name ) ; target_undepend_item ( full_path_name ) ; }",3,215,-24.930704607749284,-0.11595676561743853
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev(struct xcopy_op *xop) {
    struct se_device *remote_dev;
    char path[PATH_MAX];
    
    if (xop->op_origin == XCOL_SOURCE_RECV_OP)
        remote_dev = xop->dst_dev;
    else
        remote_dev = xop->src_dev;
        
    if (realpath(remote_dev->dev_group.cg_item, path) == NULL) {
        fprintf(stderr, ""Error getting absolute path of remote device: %s\n"", strerror(errno));
        exit(EXIT_FAILURE);
    }
    
    pr_debug(""Calling configfs_undepend_item for remote_dev: %p remote_dev->dev_group: %s\n"", remote_dev, path);
    target_undepend_item(&remote_dev->dev_group.cg_item);
}",3,236,-35.83974213177172,-0.15186331411767678
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) { if (xop->dst_dev->dev_name && strlen(xop->dst_dev->dev_name)) { remote_dev = xop->dst_dev; } else { return; } } else { if (xop->src_dev->dev_name && strlen(xop->src_dev->dev_name)) { remote_dev = xop->src_dev; } else { return; } } pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,229,-21.416857599823075,-0.09352339563241517
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; const char * absolute_path ; char * relative_path ; size_t path_len ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> absolute_path = dev_group . cg_item ; path_len = strlen ( absolute_path ) ; relative_path = malloc ( sizeof ( char ) * ( path_len + 1 ) ) ; strcpy ( relative_path , absolute_path ) ; path_normalize ( relative_path ) ; if ( strncmp ( absolute_path , relative_path , path_len ) != 0 ) { pr_err ( ""Error: Path Traversal detected in remote_dev->dev_group.cg_item\\n"" ) ; free ( relative_path ) ; return ; } pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; free ( relative_path ) ; }",3,336,-56.99570440047295,-0.1696300726204552
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) remote_dev = xop -> dst_dev ; else remote_dev = xop -> src_dev ; if ( remote_dev != NULL ) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } }",3,164,-6.2275086165022016,-0.037972613515257325
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; char *restricted_path = ""/dev/remote/"" ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> if ( strncmp ( remote_dev -> dev_group . cg_item . ci_name , restricted_path , strlen ( restricted_path ) ) == 0 ) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; } <StartBug> else { pr_err ( ""Path traversal attempted. Skipping..."" ) ; } <EndBug> }",3,257,-43.726879315495786,-0.17014349928208478
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; char * rel_path ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) { remote_dev = xop -> dst_dev ; } else { remote_dev = xop -> src_dev ; } rel_path = kern_path_relative_from_path ( ""/ sys / class / target "" , & remote_dev -> dev_group . cg_item . ci_dentry -> d_name ) ; if ( rel_path ) { pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; kfree ( rel_path ) ; } else { pr_err ( ""Unable to generate relative path for:"" "" / sys / class / target /%s\\n"" , & remote_dev -> dev_group . cg_item . ci_dentry -> d_name ) ; } }",3,283,-62.05739876700703,-0.21928409458306372
"The Original Code is vulnerable to CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'). Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code:
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { <StartBug> struct se_device * remote_dev ; <EndBug> if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) <StartBug> remote_dev = xop -> dst_dev ; <EndBug> else <StartBug> remote_dev = xop -> src_dev ; <EndBug> pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }
Fixed code:","
static void xcopy_pt_undepend_remotedev ( struct xcopy_op * xop ) { struct se_device * remote_dev ; if ( xop -> op_origin == XCOL_SOURCE_RECV_OP ) { if (strncmp(xop->dst_dev, ""../"", 3) == 0) return -EPERM; else remote_dev = xop -> dst_dev ; } else { if (strncmp(xop->src_dev, ""../"", 3) == 0) return -EPERM; else remote_dev = xop -> src_dev ; } pr_debug ( ""Calling configfs_undepend_item for"" "" remote_dev: %p remote_dev->dev_group: %p\\n"" , remote_dev , & remote_dev -> dev_group . cg_item ) ; target_undepend_item ( & remote_dev -> dev_group . cg_item ) ; }",3,215,-18.809007247489486,-0.08748375463948597
