Original code,Plausible Program,Total Tokens,Sum Entropy,Mean Entropy
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; UINT16 remaining = 0; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; remaining = Stream_GetRemainingLength ( s ) ; if ( li != remaining + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( remaining >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",280,-13.941929291386433,-0.04979260461209441
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.1305999036210497,-0.007691696402964078
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.3117510350903783,-0.00834567160682447
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; UINT16 remainingLength; UINT16 expectedLength; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; remainingLength = Stream_GetRemainingLength ( s ) ; expectedLength = ( li < 6 ) ? 0 : ( li - 6 ) ; if ( remainingLength > expectedLength ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",311,-22.996513947062393,-0.07394377474939676
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; //Check to make sure that li is less than the length of the stream if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",292,-19.885633684888457,-0.06810148522222075
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.1305999036210497,-0.007691696402964078
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; 
if (li < Stream_GetRemainingLength ( s ) + 6) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } 
if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } 
return tpkt_ensure_stream_consumed ( s , length ) ; }",283,-16.653788668631588,-0.05884730978315049
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 || li < Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",291,-6.270699889974285,-0.021548796872763867
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li < Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-4.399789799294433,-0.01588371768698351
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; UINT16 remainingLength; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } remainingLength = Stream_GetRemainingLength(s); if (remainingLength > 0 && remainingLength < 8) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",286,-18.806963896155008,-0.065758615021521
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.3117510350903783,-0.00834567160682447
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.1305999036210497,-0.007691696402964078
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; //add if statement to check bounds of li if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",286,-18.216384798539387,-0.0636936531417461
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { if ( Stream_GetRemainingLength(s) < 8 ) { WLog_ERR ( TAG , ""Invalid Stream Length."" ) ; return FALSE ; } Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",311,-15.303886667946022,-0.04920863880368496
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; UINT16 available_length; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; available_length = Stream_GetRemainingLength(s); if ( available_length < length ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( available_length < 8 ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",315,-18.99923040315442,-0.06031501715287118
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.1305999036210497,-0.007691696402964078
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.431327458988049,-0.008777355447610284
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , li ) ; }",277,-4.69006260309495,-0.016931633946191155
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",275,-5.869399468572938,-0.021343270794810684
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; int remaining_length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; remaining_length=length-6; if ( ! tpdu_read_connection_request ( s , & li , remaining_length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , remaining_length ) ; }",294,-23.108411719098893,-0.07860003986088059
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; UINT16 liLength; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } liLength = Stream_GetRemainingLength ( s ) + 6; if (li > liLength) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",329,-17.788138434700475,-0.05406729007507743
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) 
{ BYTE li ; BYTE type ; UINT16 length ; 
if ( ! tpkt_read_header ( s , & length ) ) 
return FALSE ; 
if ( ! tpdu_read_connection_request ( s , & li , length ) ) 
return FALSE ; 
if ( li > Stream_GetRemainingLength ( s ) + 6 ) { 
WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; 
return FALSE ; 
} 
if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { 
WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; 
return FALSE ; 
} 
if ( Stream_GetRemainingLength ( s ) >= 8 ) { 
Stream_Read_UINT8 ( s , type ) ; 
if ( type != TYPE_RDP_NEG_REQ ) { 
WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; 
return FALSE ; 
} 
nego_process_negotiation_request ( nego , s ) ; 
} 
return tpkt_ensure_stream_consumed ( s , length ) && ( li == Stream_GetRemainingLength ( s ) + 6 ); 
}",338,-22.418749873953146,-0.0663276623489738
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li == Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type == TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-10.518906202050253,-0.03797439062112005
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.28304091839495,-0.008242024976155055
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) + 6 < li ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",317,-8.629678597225364,-0.027222960874527965
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { int min_stream_size = 8; //add int min_stream_size if ( Stream_GetRemainingLength ( s ) < min_stream_size ) { //check if Stream_GetRemainingLength(s) is greater than min_stream_size WLog_ERR ( TAG , ""The stream size is too small. Stream size: %"" PRIuPTR "" bytes, min stream size: %d bytes."" , Stream_GetRemainingLength ( s ) , min_stream_size ) ; return FALSE ; } Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",392,-69.34313288988106,-0.17689574716806394
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) > 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-5.916131023778252,-0.021357873732051454
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.28304091839495,-0.008242024976155055
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","

BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } if (Stream_GetRemainingLength(s) > 0) { WLog_ERR(TAG, ""Stream not fully consumed.""); return FALSE; } return TRUE; }",297,-13.469318934410461,-0.045351242203402226
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; int stream_len = Stream_GetRemainingLength ( s ) ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) > 0 ) { // added check that stream_len is not greater than 8 if ( stream_len >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } else { WLog_ERR ( TAG , ""Stream length less than 8."" ) ; return FALSE ; } } return tpkt_ensure_stream_consumed ( s , length ) ; }",337,-46.194302352282634,-0.13707508116404343
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request(rdpNego* nego, wStream* s) {
    BYTE li;
    BYTE type;
    UINT16 length;
    int minLength = 6; 

    if (!tpkt_read_header(s, &length))
        return FALSE;
    if (!tpdu_read_connection_request(s, &li, length))
        return FALSE;
    if (li != Stream_GetRemainingLength(s) + minLength) {
        WLog_ERR(TAG, ""Incorrect TPDU length indicator."");
        return FALSE;
    }
    if (!nego_read_request_token_or_cookie(nego, s)) {
        WLog_ERR(TAG, ""Failed to parse routing token or cookie."");
        return FALSE;
    }

    if (Stream_GetRemainingLength(s) >= 8) {
        Stream_Read_UINT8(s, type);
        if (type != TYPE_RDP_NEG_REQ) {
            WLog_ERR(TAG, ""Incorrect negotiation request type %"" PRIu8 """", type);
            return FALSE;
        }
        nego_process_negotiation_request(nego, s);
    }
    return tpkt_ensure_stream_consumed(s, length);
}",322,-32.31695886671331,-0.10036322629414071
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.28304091839495,-0.008242024976155055
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; UINT16 data_length; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength(s) ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; }  data_length = li = Stream_GetRemainingLength(s); if ( ! nego_read_request_token_or_cookie ( nego , s , data_length ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",302,-34.72499625246758,-0.11498343129956151
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { if (Stream_GetRemainingLength ( s ) + 6 != li) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",317,-12.087609217731837,-0.038131259361930084
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; UINT16 remaining_length; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; remaining_length = Stream_GetRemainingLength ( s ) + 6; if ( li > remaining_length ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",292,-8.56242804545149,-0.029323383717299624
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; UINT16 remainingLength ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; remainingLength = Stream_GetRemainingLength ( s ) ; if ( li != remainingLength + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( remainingLength > 0 && ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( remainingLength >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",287,-10.608344672907332,-0.036962873424764224
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; if ( li > Stream_GetRemainingLength ( s ) ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } } return tpkt_ensure_stream_consumed ( s , length ) ; }",315,-11.657432823158548,-0.037007723248122376
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.302844076014699,-0.00831351651990866
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; /* Fixed out-of-bounds read vulnerability */ if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",288,-15.329641166191658,-0.05322792071594326
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.302844076014699,-0.00831351651990866
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; 
if (li > Stream_GetRemainingLength(s) + 6) {
    WLog_ERR(TAG, ""Incorrect TPDU length indicator."");
    return FALSE;
}",322,-12.456230728061747,-0.03868394636044021
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; 
if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } 
if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } 
if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",283,-9.446377942307715,-0.03337942735797779
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.329597834645749,-0.008410100486085736
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; UINT16 minLength ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; minLength = Stream_GetPosition ( s ) + 6 ; if ( li < minLength) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , minLength) ; }",288,-22.954761364045243,-0.07970403251404598
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; UINT8 buffer[4096]; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } // Added Code if (length > 4096) { WLog_ERR ( TAG , ""Negotiation request length is too long"" ) ; return FALSE ; } Stream_Read(s, buffer, length) ; nego_process_negotiation_request ( nego , (wStream*) buffer ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",333,-46.108981548303085,-0.1384654100549642
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","

BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( length > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",278,-15.560611886918004,-0.05597342405366188
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; UINT16 expected_length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; expected_length = Stream_GetRemainingLength ( s ) + 6 ; if ( li != expected_length ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( length < expected_length ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",324,-11.459082717802191,-0.0353675392524759
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.302844076014699,-0.00831351651990866
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li > Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }",277,-2.2869061373276507,-0.008255978835117873
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } nego_process_negotiation_request ( nego , s ) ; } return tpkt_ensure_stream_consumed ( s , length ) ; }
Fixed code:","
BOOL nego_read_request ( rdpNego * nego , wStream * s ) { BYTE li ; BYTE type ; UINT16 length ; size_t min_length = 0; if ( ! tpkt_read_header ( s , & length ) ) return FALSE ; if ( ! tpdu_read_connection_request ( s , & li , length ) ) return FALSE ; if ( li != Stream_GetRemainingLength ( s ) + 6 ) { WLog_ERR ( TAG , ""Incorrect TPDU length indicator."" ) ; return FALSE ; } if ( ! nego_read_request_token_or_cookie ( nego , s ) ) { WLog_ERR ( TAG , ""Failed to parse routing token or cookie."" ) ; return FALSE ; } if ( Stream_GetRemainingLength ( s ) >= 8 ) { Stream_Read_UINT8 ( s , type ) ; if ( type != TYPE_RDP_NEG_REQ ) { WLog_ERR ( TAG , ""Incorrect negotiation request type %"" PRIu8 """" , type ) ; return FALSE ; } min_length = Stream_GetPosition(s) + Stream_GetRemainingLength(s); nego_process_negotiation_request ( nego , s ) ; } return (min_length <= length) && tpkt_ensure_stream_consumed ( s , length ) ; }",315,-23.164796079508502,-0.07353903517304286
