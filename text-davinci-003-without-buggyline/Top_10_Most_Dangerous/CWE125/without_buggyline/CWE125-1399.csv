Original code,Plausible Program,Total Tokens,Sum Entropy,Mean Entropy
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",408,-3.0211265250172996,-0.007404721875042401
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",408,-5.417488115356899,-0.013278157145482595
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",408,-2.9609149449303955,-0.007257144472868617
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; fh . version [ sizeof ( fh . version ) - 1 ] = '\0' ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",429,-5.360278344912802,-0.01249482131681306
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; //Fix: Ensure the string is null-terminated fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",419,-15.484973056913573,-0.036956976269483466
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; if(ninst > 0) { for ( i = 0 ; i < ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
In the fixed code, the loop condition was changed from <= to < to prevent an out-of-bounds read.",441,-24.930412610027993,-0.0565315478685442
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { 
  int fd ; 
  struct filter_op * fop ; 
  struct filter_header fh ; 
  size_t ninst , i ; 
  u_char * data ; 
  ninst = compile_tree ( & fop ) ; 
  if ( fop == NULL ) return - E_NOTHANDLED ; 
  fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; 
  ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; 
  fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; 
  fflush ( stdout ) ; 
  fh . magic = htons ( EC_FILTER_MAGIC ) ; 
  strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1) ; //Boundary check
  fh . data = sizeof ( fh ) ; 
  data = create_data_segment ( & fh , fop , ninst ) ; 
  write ( fd , & fh , sizeof ( struct filter_header ) ) ; 
  write ( fd , data , fh . code - fh . data ) ; 
  for ( i = 0 ; i < ninst ; i ++ ) { //Check for < instead of <=
    print_progress_bar ( & fop [ i ] ) ; 
    write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; 
  } 
  close ( fd ) ; 
  fprintf ( stdout , "" done.\\n\\n"" ) ; 
  fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; 
  return E_SUCCESS ; 
}",494,-29.52184816452016,-0.05976082624396794
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) {
    int fd ;
    struct filter_op * fop ;
    struct filter_header fh ;
    size_t ninst , i ;
    u_char * data ;
    ninst = compile_tree ( & fop ) ;
    if ( fop == NULL ) return - E_NOTHANDLED ;
    fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ;
    ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ;
    fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ;
    fflush ( stdout ) ;
    fh . magic = htons ( EC_FILTER_MAGIC ) ;
    strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ;
    fh . data = sizeof ( fh ) ;
    data = create_data_segment ( & fh , fop , ninst ) ;
    write ( fd , & fh , sizeof ( struct filter_header ) ) ;
    write ( fd , data , fh . code - fh . data ) ;
    for ( i = 0 ; i <= ninst ; i ++ ) {
        print_progress_bar ( & fop [ i ] ) ;
        write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ;
    }
    close ( fd ) ;
    fprintf ( stdout , "" done.\\n\\n"" ) ;
    fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ;
    return E_SUCCESS ;
}",459,-10.436987385972042,-0.022738534609960875
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; 
strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; 
fh . version[sizeof ( fh.version ) - 1] = '\0'; 
fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",433,-19.35953271282175,-0.04471023721205947
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; //added -1 to make sure the string is null-terminated fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",422,-12.94351534461083,-0.030671837309504336
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , min( sizeof ( fh . version ) , strlen(EC_VERSION))) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",415,-13.689845270303756,-0.032987578964587365
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i < ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i ) ) ; return E_SUCCESS ; }",404,-4.099547655477732,-0.010147395186826069
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; fh . version[sizeof (fh.version) - 1] = '\0'; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",429,-7.69690406546245,-0.01794150131809429
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; if (strlen(EC_VERSION)>sizeof(fh.version)) { strncpy ( fh . version , EC_VERSION , sizeof ( fh . version )-1 ) ; } else { strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; } fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",453,-14.634546641906983,-0.03230584247661586
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; //Fix Out-of-bounds Read fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",417,-12.504039000483509,-0.029985705037130717
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; fh . version[sizeof(fh.version)-1] = '\0'; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",428,-5.185368609796895,-0.012115347219151624
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }

The vulnerability in the original code was caused by an out-of-bounds read. This issue is fixed by modifying the strncpy() function call in the code to include a null-terminator. The modified code now includes strncpy() with the size of the fh.version buffer minus one, to add a null-terminator character to ensure that a string is properly terminated.",491,-85.19588185888331,-0.17351503433581122
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; //Vulnerability fixed fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",412,-12.648626999335733,-0.030700550969261487
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; //prevents buffer overflow fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",413,-11.461532687323858,-0.027751895126692152
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; if (strlen(EC_VERSION) >= sizeof(fh.version)) { /* Added to prevent buffer overflow */ return E_FAILURE; } strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fh , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",436,-25.374293214250134,-0.058197920216170033
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst && i < ninst; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }

The vulnerability was fixed by adding an additional comparison in the for loop, ensuring that i does not exceed the value of ninst. The code now reads as: 
for ( i = 0 ; i <= ninst && i < ninst; i ++ )",466,-44.52560125989799,-0.095548500557721
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1) ; // add -1 to fix the out-of-bounds read fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",422,-15.569768763900896,-0.03689518664431492
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; // Added -1 to strncpy to avoid buffer overflow fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; if (i < ninst){ // Added check to make sure we don't write past the allocated buffer write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",442,-31.670220325847087,-0.07165208218517441
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; // Added -1 to avoid writing past the end of the buffer  fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",422,-18.139460902289343,-0.04298450450779465
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; //added -1 to ensure null-termination fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",417,-12.081534659833308,-0.028972505179456372
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; if (strlen(EC_VERSION)<sizeof(fh.version)){ strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; } else { return - E_BUFFER_SIZE; } fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",438,-20.789716762690425,-0.04746510676413339
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",408,-2.9674143527075967,-0.007273074393891168
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , EC_VERSION_SIZE ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",404,-8.369368219296241,-0.020716257968555054
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",408,-2.9674143527075967,-0.007273074393891168
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; if (strlen(EC_VERSION) < sizeof(fh.version)) { strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; } else { fh . version [ sizeof ( fh . version ) - 1 ] = '\0' ; }  fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",450,-18.081568411202007,-0.04018126313600446
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; 
//Add a check to ensure the length of the version string does not exceed the size of the array. 
if (strlen(EC_VERSION) < sizeof(fh.version))
{
    strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ;
}
else
{
    strncpy ( fh . version , EC_VERSION , strlen(EC_VERSION) ) ;
}
fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",485,-34.65908319255427,-0.07146202720114282
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:"," 
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",409,-5.381053405189641,-0.013156609792639709
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; fh . version[sizeof(fh.version) - 1] = '\0'; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",429,-4.93434934498425,-0.011501979825138113
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; //add check if strlen(EC_VERSION) does not exceed sizeof(fh.version) 
if (strlen(EC_VERSION)>sizeof(fh.version)) { return E_ERROR; }
strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; //add check if i does not exceed ninst
if (i > ninst) { return E_ERROR; }
 } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",481,-43.73692271168738,-0.0909291532467513
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; memset(fh.version, 0, sizeof(fh.version)) //add this line
strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { 
//add a check to make sure i is not greater than ninst
if (i > ninst) { 
break; 
}
print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",461,-38.68271661395878,-0.08391044818646157
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output(void) {
 int fd;
 struct filter_op *fop;
 struct filter_header fh;
 size_t ninst, i;
 u_char *data;
 ninst = compile_tree(&fop);
 if (fop == NULL)
  return -E_NOTHANDLED;
 fd = open(EF_GBL_OPTIONS->output_file, O_CREAT | O_RDWR | O_TRUNC | O_BINARY, 0644);
 ON_ERROR(fd, -1, ""Can\'t create file %s"", EF_GBL_OPTIONS->output_file);
 fprintf(stdout, "" Writing output to \\\'%s\\\' "", EF_GBL_OPTIONS->output_file);
 fflush(stdout);
 fh.magic = htons(EC_FILTER_MAGIC);
 strncpy(fh.version, EC_VERSION, sizeof(fh.version)-1);
 fh.data = sizeof(fh);
 data = create_data_segment(&fh, fop, ninst);
 write(fd, &fh, sizeof(struct filter_header));
 write(fd, data, fh.code - fh.data);
 for (i = 0; i < ninst; i++) {
  print_progress_bar(&fop[i]);
  write(fd, &fop[i], sizeof(struct filter_op));
 }
 close(fd);
 fprintf(stdout, "" done.\\n\\n"");
 fprintf(stdout, "" -> Script encoded into %d instructions.\\n\\n"", (int)(i));
 return E_SUCCESS;
}",400,-15.068199269422346,-0.03767049817355586
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , min(sizeof ( fh . version ) ,strnlen(EC_VERSION,256)) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",420,-19.73553524499898,-0.046989369630949955
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , min(sizeof ( fh . version ), strlen(EC_VERSION)) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fh , min(sizeof ( struct filter_op ), ninst) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",419,-13.067604716284196,-0.031187600754854883
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; // Add -1 to the size of fh.version to prevent buffer overflow fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",424,-12.873505356716903,-0.030362040935653072
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( ninst == 0 || fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i < ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i ) ) ; return E_SUCCESS ; }",411,-9.635526076780819,-0.023444102376595666
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; //Add check to make sure strncpy does not write beyond the bounds of the buffer 
if(strlen(EC_VERSION) < sizeof(fh.version)) {
    strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ;
} else {
    strncpy ( fh . version , EC_VERSION , strlen(EC_VERSION) ) ;
}
fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",477,-29.70931509294442,-0.06228367944013505
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , strlen(EC_VERSION)) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fp [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",405,-11.963235745976098,-0.029538853693768144
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; // Add ""-1"" to strncpy function to avoid buffer overflow fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",422,-16.633030743985692,-0.039414764796174624
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version )-1 ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",408,-5.019189266357397,-0.01230193447636617
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) -1) ; fh . version [ sizeof ( fh . version ) - 1 ] = '\0' ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",429,-10.457898121902907,-0.024377384899540576
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i < ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i ) ) ; return E_SUCCESS ; }",404,-4.2365545064291,-0.010486521055517575
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; if (strlen(EC_VERSION) >= sizeof(fh.version)) 
  strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ;
else
  strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ;
fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fh , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",452,-19.339645903497022,-0.04278682722012615
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { 
int fd ; 
struct filter_op * fop ; 
struct filter_header fh ; 
size_t ninst , i ; 
u_char * data ; 
ninst = compile_tree ( & fop ) ; 
if ( fop == NULL ) 
return - E_NOTHANDLED ; 
fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; 
ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; 
fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; 
fflush ( stdout ) ; 
fh . magic = htons ( EC_FILTER_MAGIC ) ; 
strncpy ( fh . version , EC_VERSION , sizeof ( fh . version )-1 ) ; 
fh . data = sizeof ( fh ) ; 
data = create_data_segment ( & fh , fop , ninst ) ; 
write ( fd , & fh , sizeof ( struct filter_header ) ) ; 
write ( fd , data , fh . code - fh . data ) ; 
for ( i = 0 ; i < ninst ; i ++ ) { 
print_progress_bar ( & fop [ i ] ) ; 
write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; 
} 
close ( fd ) ; 
fprintf ( stdout , "" done.\\n\\n"" ) ; 
fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i ) ) ; 
return E_SUCCESS ; 
}",460,-12.58826942621314,-0.027365803100463347
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; //ADDED -1 fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }",413,-11.410263362434488,-0.027627756325507236
"The Original Code is vulnerable to CWE-125: Out-of-bounds Read. Fix the vulnerability.
Original Code:
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }
Fixed code:","
int write_output ( void ) { int fd ; struct filter_op * fop ; struct filter_header fh ; size_t ninst , i ; u_char * data ; ninst = compile_tree ( & fop ) ; if ( fop == NULL ) return - E_NOTHANDLED ; fd = open ( EF_GBL_OPTIONS -> output_file , O_CREAT | O_RDWR | O_TRUNC | O_BINARY , 0644 ) ; ON_ERROR ( fd , - 1 , ""Can\'t create file %s"" , EF_GBL_OPTIONS -> output_file ) ; fprintf ( stdout , "" Writing output to \\\'%s\\\' "" , EF_GBL_OPTIONS -> output_file ) ; fflush ( stdout ) ; fh . magic = htons ( EC_FILTER_MAGIC ) ; strncpy ( fh . version , EC_VERSION , sizeof ( fh . version ) - 1 ) ; fh . data = sizeof ( fh ) ; data = create_data_segment ( & fh , fop , ninst ) ; write ( fd , & fh , sizeof ( struct filter_header ) ) ; write ( fd , data , fh . code - fh . data ) ; for ( i = 0 ; i <= ninst ; i ++ ) { print_progress_bar ( & fop [ i ] ) ; write ( fd , & fop [ i ] , sizeof ( struct filter_op ) ) ; } close ( fd ) ; fprintf ( stdout , "" done.\\n\\n"" ) ; fprintf ( stdout , "" -> Script encoded into %d instructions.\\n\\n"" , ( int ) ( i - 1 ) ) ; return E_SUCCESS ; }

The vulnerability has been fixed by changing the line strncpy(fh.version, EC_VERSION, sizeof(fh.version)) to strncpy(fh.version, EC_VERSION, sizeof(fh.version) - 1). This ensures that no out-of-bounds read is conducted, thus preventing the CWE-125 vulnerability.",486,-33.8899900878656,-0.06973248989272757
