Original code,Plausible Program,Total Tokens,Sum Entropy,Mean Entropy
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:","
static VALUE read_memory ( VALUE klass , VALUE content ) { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt(NULL);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif <StartBug>xmlSchemaParseDoc(ctx, xmlParseMemory(StringValuePtr(content), (int)RSTRING_LEN(content)));<EndBug> schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",353,-12.575124063889207,-0.03562358091753316
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:","  <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) , 0 ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",347,-11.029535013526035,-0.031785403497193186
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:","
<StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { 
xmlSchemaPtr schema ; 
<StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( ( const char * ) StringValuePtr ( content ) ) ;<EndBug> 
VALUE rb_schema ; 
<Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> 
xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; 
# ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS 
xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; 
# endif 
schema = xmlSchemaParse ( ctx ) ; 
xmlSetStructuredErrorFunc ( NULL , NULL ) ; 
xmlSchemaFreeParserCtxt ( ctx ) ; 
if ( NULL == schema ) { 
xmlErrorPtr error = xmlGetLastError ( ) ; 
if ( error ) 
Nokogiri_error_raise ( NULL , error ) ; 
else 
rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; 
return Qnil ; 
} 
rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; 
rb_iv_set ( rb_schema , ""@errors"" , errors ) ; 
return rb_schema ; 
}",374,-13.521136995003484,-0.03615277271391306
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlParserCtxtPtr ctx = xmlNewParserCtxt ( ) ; xmlSchemaParserCtxtPtr s_ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaSetParserStructuredErrors ( s_ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; xmlParseDoc ( ctx , ( const xmlChar * ) StringValuePtr ( content ) ) ; <EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; schema = xmlSchemaParse ( s_ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( s_ctx ) ; xmlFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",375,-21.65139610878973,-0.05773705629010595
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," static VALUE read_memory ( VALUE klass , VALUE content ) { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( ( const char * ) StringValuePtr ( content ) );<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",321,-10.452340726488853,-0.0325618091167877
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," static VALUE read_memory ( VALUE klass , VALUE content ) { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt (  StringValuePtr ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",318,-10.779838966058536,-0.03389886467314005
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:","
<StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaDisable(ctx, XML_SCHEMAS_ENABLE_EXTERNAL);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",366,-12.96289093282416,-0.035417734789137054
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaDisableParserExtRefs(ctx);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",355,-5.498982926570809,-0.015490092750903689
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:","<StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; xmlSchemaParserCtxtPtr ctx; <StartBug>ctx = xmlSchemaNewParserCtxt(NULL); xmlSchemaSetParserStructuredErrors(ctx, Nokogiri_error_array_pusher, (void *)rb_ary_new()); xmlSchemaSetParserStructuredErrors(ctx, Nokogiri_error_array_pusher, (void *) rb_ary_new()); xmlSchemaSetParserStructuredErrors(ctx, Nokogiri_error_array_pusher, (void *) rb_ary_new()); xmlSchemaParseDoc(ctx, (const xmlChar *)StringValuePtr(content), RSTRING_LEN(content));<EndBug> VALUE rb_schema ; VALUE errors = rb_ary_new ( ) ; xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",444,-31.726334723360267,-0.071455708836397
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaSetParserStructuredErrors(ctx, Nokogiri_error_array_pusher, (void *) errors); xmlSchemaDisableParserExtRefs(ctx);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",384,-11.517779253157745,-0.029994216805098294
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:","
<StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt(StringValuePtr ( content ) );<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",325,-10.23915680519874,-0.031505097862149965
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( StringValuePtr ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",325,-4.338435836865708,-0.013349033344202179
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt((const char *) StringValuePtr(content), (int) RSTRING_LEN(content)); xmlSchemaSetParserStructuredErrors(ctx, Nokogiri_error_array_pusher, (void *) errors);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",315,-12.929323403398273,-0.04104547112189928
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( ( const char * ) StringValuePtr ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",330,-3.544644416555995,-0.010741346716836348
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:","
<StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( StringValuePtr ( content ) ) ; xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",358,-8.990167526477414,-0.02511219979462965
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) , XML_PARSE_NOENT ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",352,-4.761391223117003,-0.01352667961112785
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaSetParserStructuredErrors(ctx, NULL, NULL);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",360,-4.176934093537894,-0.011602594704271928
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( ( const char * ) StringValuePtr ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",330,-3.5314920192647454,-0.010701490967468925
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaDisableParserExt(ctx, XML_SCHEMAP_EXT_XML_INTERNAL_ENTITIES);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",372,-14.292233891600016,-0.03841998357956994
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt( (const char *)StringValuePtr( content ), (int)RSTRING_LEN( content ), NULL);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",342,-11.629655181750433,-0.034004839712720565
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaDisableParserExtRefs ( ctx ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",357,-8.876083983731165,-0.0248629803465859
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) , 0 ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",346,-5.843517680703333,-0.016888779423998072
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( ( const char * ) StringValuePtr ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",330,-3.4232906513244097,-0.010373608034316393
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( ( const char * ) StringValuePtr ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",330,-3.5314920192647454,-0.010701490967468925
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaSetParserErrors(ctx, (xmlSchemaValidityErrorFunc) fprintf, (xmlSchemaValidityWarningFunc) fprintf, stderr);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",384,-12.294547499241226,-0.032017050779274026
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) , XML_PARSE_NOENT ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",352,-5.932159598051005,-0.01685272613082672
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:","

static VALUE read_memory ( VALUE klass , VALUE content ) { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( StringValuePtr ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",319,-8.84355683675328,-0.027722748704555735
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( StringValuePtr ( content ) ) ; xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",304,-6.721818518459979,-0.02211124512651309
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaDisableParserExtEnt(ctx);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",354,-6.340851317864555,-0.017912009372498743
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug> static VALUE read_memory ( VALUE klass , VALUE content ) <EndBug> { xmlSchemaPtr schema ; xmlSchemaParserCtxtPtr ctx ; VALUE rb_schema ; <StartBug>VALUE errors = rb_ary_new ( ) ; ctx = xmlSchemaNewParserCtxt ( StringValuePtr ( content ) ) ; xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ;<EndBug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; #ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; #endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",352,-19.781027415631122,-0.056196100612588416
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaSetParserStructuredErrors(ctx, NULL, NULL);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",360,-4.176934093537894,-0.011602594704271928
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( ( const char * ) StringValuePtr ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",330,-3.5314920192647454,-0.010701490967468925
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( NULL ) ; xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) rb_ary_new ( ) ) ; xmlSchemaParseDoc ( ctx , ( const xmlChar * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogi",181,-22.014233618378604,-0.12162560010153925
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ), 0) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",345,-6.709980925802011,-0.01944922007478844
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaSetParserStructuredErrors(ctx, Nokogiri_error_array_pusher, (void *) errors);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",320,-9.778612638078672,-0.03055816449399585
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaSetParserStructuredErrors(ctx, NULL, NULL);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",360,-4.331259129723484,-0.01203127536034301
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt(StringValuePtr(content));<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",323,-7.243680373712066,-0.02242625502697234
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaSetParserStructuredErrors(ctx, NULL, NULL);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",360,-4.331259129723484,-0.01203127536034301
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( NULL) ; xmlSchemaSetParserStructuredErrors(ctx, Nokogiri_error_array_pusher, (void*) errors); xmlSchemaParseDoc(ctx, (const xmlChar*) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",384,-17.454794391646203,-0.04545519372824532
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ), NULL ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",345,-5.976646097002015,-0.01732361187536816
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:","<StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt(NULL);<EndBug> xmlSchemaSetParserStructuredErrors(ctx, Nokogiri_error_array_pusher, (void *) errors); xmlSchemaValidCtxtPtr valid = xmlSchemaNewValidCtxt(ctx); xmlSchemaSetValidStructuredErrors(valid, Nokogiri_error_array_pusher, (void *) errors); xmlSchemaSetParserStructuredErrors(ctx, Nokogiri_error_array_pusher, (void *) errors); xmlSchemaParse(ctx, (const char *)StringValuePtr(content), (int)RSTRING_LEN(content)); xmlSchemaFreeParserCtxt(ctx); VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",465,-28.528430852776246,-0.06135146419951881
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:","
<StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt(NULL);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif xmlSchemaParseDoc(ctx, (xmlDocPtr)StringValuePtr(content)); schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",340,-11.94810716534309,-0.0351414916627738
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ), NULL ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",345,-6.393166520722569,-0.018530917451369765
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt(NULL); xmlSchemaSetParserStructuredErrors(ctx, Nokogiri_error_array_pusher, (void*) errors); xmlSchemaParseDoc(ctx, xmlParseMemory((const char*) StringValuePtr (content), (int) RSTRING_LEN (content)));<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",331,-17.01514252133985,-0.05140526441492402
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:","
static VALUE read_memory ( VALUE klass , VALUE content ) { xmlSchemaPtr schema ; xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( NULL ) ; VALUE rb_schema ; VALUE errors = rb_ary_new ( ) ; xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; #ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; #endif xmlSchemaParseDoc ( ctx , ( xmlDocPtr ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",334,-10.748000440185024,-0.03217964203648211
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) , XML_PARSE_NOENT ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",352,-4.846322958769599,-0.013767962951049996
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ; xmlSchemaSetParserStructuredErrors(ctx, NULL, NULL);<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",360,-4.3887978403616,-0.012191105112115555
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," 
static VALUE read_memory ( VALUE klass , VALUE content ) { xmlSchemaPtr schema ; 
xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( NULL ) ; 
VALUE rb_schema ; 
VALUE errors = rb_ary_new ( ) ; 
xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; 
xmlSchemaParseDoc ( ctx , ( xmlDocPtr ) content ) ; 
schema = xmlSchemaParse ( ctx ) ; 
xmlSetStructuredErrorFunc ( NULL , NULL ) ; 
xmlSchemaFreeParserCtxt ( ctx ) ; 
if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; 
if ( error ) Nokogiri_error_raise ( NULL , error ) ; 
else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; 
return Qnil ; 
} 
rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; 
rb_iv_set ( rb_schema , ""@errors"" , errors ) ; 
return rb_schema ; 
}",300,-21.06442339110861,-0.07021474463702869
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) , 0 ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",346,-4.180646833804743,-0.012082794317354748
"The Original Code is vulnerable to CWE-611: Improper Restriction of XML External Entity Reference. Fix the code between <StartBug> and <EndBug> to fix the vulnerability.
Original Code: <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewMemParserCtxt ( ( const char * ) StringValuePtr ( content ) , ( int ) RSTRING_LEN ( content ) ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }
Fixed code:"," <StartBug>static VALUE read_memory ( VALUE klass , VALUE content )<EndBug> { xmlSchemaPtr schema ; <StartBug>xmlSchemaParserCtxtPtr ctx = xmlSchemaNewParserCtxt ( StringValuePtr ( content ) ) ; xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ;<EndBug> VALUE rb_schema ; <Startbug>VALUE errors = rb_ary_new ( ) ;<Endbug> xmlSetStructuredErrorFunc ( ( void * ) errors , Nokogiri_error_array_pusher ) ; # ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS xmlSchemaSetParserStructuredErrors ( ctx , Nokogiri_error_array_pusher , ( void * ) errors ) ; # endif schema = xmlSchemaParse ( ctx ) ; xmlSetStructuredErrorFunc ( NULL , NULL ) ; xmlSchemaFreeParserCtxt ( ctx ) ; if ( NULL == schema ) { xmlErrorPtr error = xmlGetLastError ( ) ; if ( error ) Nokogiri_error_raise ( NULL , error ) ; else rb_raise ( rb_eRuntimeError , ""Could not parse document"" ) ; return Qnil ; } rb_schema = Data_Wrap_Struct ( klass , 0 , dealloc , schema ) ; rb_iv_set ( rb_schema , ""@errors"" , errors ) ; return rb_schema ; }",357,-7.433453730207864,-0.020821999244279733
