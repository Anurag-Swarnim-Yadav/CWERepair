Original code,Plausible Program,Total Tokens,Sum Entropy,Mean Entropy
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ;  if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ;  } else { if (str_len > p - str - 1) { * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ;  } } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { if (str_len > colon - str) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } }",413,-40.234099274097424,-0.09741912657166446
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," 
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { //Validate the input to ensure it is not malicious or malformed char isHostValid = validateIPAddress(str); if (!isHostValid) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"" due to security vulnerability"" , str ) ; } return NULL ; } char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; } 

//Function to validate the input 
int validateIPAddress(char *str) { //Check if the input is a valid IP address if (isValidIPv4Address(str)) { return 1; } if (isValidIPv6Address(str)) { return 1; } else { return 0; } } 

//Function to validate the IPv4 address 
int isValidIPv4Address(char *str) { //Parse the input to check if it is a valid IPv4 address int parts[4]; char *p = str; while (*p) { if (sscanf(p, ""%d%n"", &parts[i], &n) < 1 || n <= 0) { return 0; } if (parts[i] > 255) { return 0; } p += n; i++; if (*p != '.' && *p != '\0') { return 0; } p++; } if (i != 4) { return 0; } return 1; } 

//Function to validate the IPv6 address 
int isValidIPv6Address(char *str) { //Parse the input to check if it is a valid IPv6 address char address[40]; int ab[8]; int c = 0; int i; char *p = str; int n; while (c < 8) { int abc = 0; while (1) { int t; if (sscanf(p, ""%4x%n"", &t, &n) < 1 || n <= 0) { return 0; } ab[c] = t; abc++; p += n; if (*p == '\0' || *p == ':') { break; } else if (*p != '.') { return 0; } p++; } if (abc != 1 && abc != 4) { return 0; } c += abc; if (*p == '\0') { break; } p++; } if (c != 8) { return 0; } return 1; }",814,-212.67726137266442,-0.2612742768705951
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; // Check if port number is within valid range if (*portno < 0 || *portno > 65535) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL; } return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; // Check if port number is within valid range if (*portno < 0 || *portno > 65535) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL; } host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",428,-16.85858538396884,-0.039389218186843086
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; // Limit the size of the port number to 8 bytes or less to prevent buffer overflows if (*portno > 0 && *portno < 65536) { return estrndup ( str + 1 , p - str - 1 ) ; } else { if (get_err) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; // Limit the size of the port number to 8 bytes or less to prevent buffer overflows if (*portno > 0 && *portno < 65536) { host = estrndup ( str , colon - str ) ; } else { if (get_err) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",407,-42.911199338959484,-0.10543292220874566
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( (str_len > 4 && * ( str ) == '[' && str[str_len-1] == ']') || ( str_len > 3 && * ( str ) == '[' && str[str_len-2] == ']' && str[str_len-1] == ':') ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",353,-30.374909238450943,-0.08604790152535678
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; // Restrict Portno to 0-65535 and ensure any port numbers outside this range is rejected  if(*portno < 0 || *portno > 65535) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; // Restrict Portno to 0-65535 and ensure any port numbers outside this range is rejected  if(*portno < 0 || *portno > 65535) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",449,-55.90193999606809,-0.12450320711819172
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; 
//Check if port number is within valid range //
if (*portno < 0 || *portno > 65535) { if (get_err) { *err = strpprintf(0, ""Port number out of range \\""%s\\"""", str); } return NULL; }
return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; 
//Check if port number is within valid range//
if (*portno < 0 || *portno > 65535) { if (get_err) { *err = strpprintf(0, ""Port number out of range \\""%s\\"""", str); } return NULL; }
host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",432,-34.19451633957793,-0.07915397300828225
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; if(*portno <= 0 || *portno > 65535){ if ( get_err ) { * err = strpprintf ( 0 , ""Invalid port number \\""%d\\"""" , *portno ) ; return NULL; } } return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; if(*portno <= 0 || *portno > 65535){ if ( get_err ) { * err = strpprintf ( 0 , ""Invalid port number \\""%d\\"""" , *portno ) ; return NULL; } } host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",403,-17.9930054186541,-0.044647656125692554
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," 
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { 
	char * colon ; 
	char * host = NULL ; 
	# ifdef HAVE_IPV6 
		char * p ; 
		if ( * ( str ) == '[' && str_len > 1 ) { 
			p = memchr ( str + 1 , ']' , str_len - 2 ) ; 
			if ( ! p || * ( p + 1 ) != ':' ) { 
				if ( get_err ) { 
					* err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; 
				} 
				return NULL ; 
			} 
			if (p - str - 1 == 0) { // Added condition
				if (get_err) {
					*err = strpprintf(0, ""Failed to parse IPv6 address \\""%s\\"""" , str);
				}
				return NULL;
			}
			* portno = atoi ( p + 2 ) ; 
			return estrndup ( str + 1 , p - str - 1 ) ; 
		} 
	# endif 
	if ( str_len ) { 
		colon = memchr ( str , ':' , str_len - 1 ) ; 
	} else { 
		colon = NULL ; 
	} 
	if ( colon ) { 
		* portno = atoi ( colon + 1 ) ; 
		host = estrndup ( str , colon - str ) ; 
		if (colon - str == 0) { // Added condition
			if (get_err) {
				*err = strpprintf(0, ""Failed to parse address \\""%s\\"""" , str);
			}
			return NULL;
		}
	} else { 
		if ( get_err ) { 
			* err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; 
		} 
		return NULL ; 
	} 
	return host ; 
}",588,-31.019565344030863,-0.05275436282998446
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { 
char * colon ; char * host = NULL ; 
# ifdef HAVE_IPV6 
char * p ; 
if ( * ( str ) == '[' && str_len > 1 ) { 
p = memchr ( str + 1 , ']' , str_len - 2 ) ; 
if ( ! p || * ( p + 1 ) != ':' || str_len <= 2 ) { 
if ( get_err ) { 
* err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; 
} 
return NULL ; 
} 
* portno = atoi ( p + 2 ) ; 
if(str_len > 2 && isAlpha(str+2)){ // Check for SSRF through alpha characters
if ( get_err ) { 
* err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; 
} 
return NULL ; 
} 
return estrndup ( str + 1 , p - str - 1 ) ; 
} 
# endif 
if ( str_len ) { 
colon = memchr ( str , ':' , str_len - 1 ) ; 
} else { 
colon = NULL ; 
} 
if ( colon ) { 
* portno = atoi ( colon + 1 ) ; 
host = estrndup ( str , colon - str ) ; 
if(str_len > 2 && isAlpha(host)){ // Check for SSRF through alpha characters
if ( get_err ) { 
* err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; 
} 
return NULL ; 
} 
} else { 
if ( get_err ) { 
* err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; 
} 
return NULL ; 
} 
return host ; 
}",516,-68.06122004562876,-0.13190158923571466
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { 
	char * colon ; 
	char * host = NULL ; 
	int is_ipv6 = 0;
# ifdef HAVE_IPV6 
	char * p ; 
	if ( * ( str ) == '[' && str_len > 1 ) { 
		p = memchr ( str + 1 , ']' , str_len - 2 ) ; 
		if ( ! p || * ( p + 1 ) != ':' ) { 
			if ( get_err ) { 
				* err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; 
			} 
			return NULL ; 
		} 
		is_ipv6 = 1;
		* portno = atoi ( p + 2 ) ; 
		return estrndup ( str + 1 , p - str - 1 ) ; 
	} 
# endif 
	if ( str_len ) { 
		colon = memchr ( str , ':' , str_len - 1 ) ; 
	} else { 
		colon = NULL ; 
	} 
	if ( colon ) { 
		if (is_ipv6) { 
			if (get_err) {
				* err = strpprintf(0, ""Failed to parse IPv6 address \\""%s\\"""", str);
			}
			return NULL;
		}
		* portno = atoi ( colon + 1 ) ; 
		host = estrndup ( str , colon - str ) ; 
	} else { 
		if ( get_err ) { 
			* err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; 
		} 
		return NULL ; 
	} 
	return host ; 
}",512,-34.991131432852185,-0.06834205357978942
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; //Check if port is within allowed range if (*portno < 0 || *portno > 65535) { if (get_err) { *err = strpprintf(0, ""Failed to parse IPv6 address \\""%s\\"" : Invalid port number"" , str); } return NULL; }  return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; //Check if port is within allowed range if (*portno < 0 || *portno > 65535) { if (get_err) { *err = strpprintf(0, ""Failed to parse address \\""%s\\"" : Invalid port number"" , str); } return NULL; } host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",432,-31.268520801003472,-0.07238083518750804
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; host = estrndup ( str + 1 , p - str - 1 ) ; } else if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",333,-13.774700945733594,-0.04136546830550629
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; if (*portno > 0 && *portno < 65535) { return estrndup ( str + 1 , p - str - 1 ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; if (*portno > 0 && *portno < 65535) { host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",371,-11.47999783400875,-0.030943390388163745
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { //Check if the host is IPv6 p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } //Check for port number to avoid malicious SSRF attack if (*(p+2) >= '0' && *(p+2) <= '9'){ * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { //Check for port number to avoid malicious SSRF attack if (*(colon+1) >= '0' && *(colon+1) <= '9'){ * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",419,-49.247862212734425,-0.11753666399220626
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," 
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } //check if the port is valid if (!(atoi(p + 2) > 0 && atoi(p + 2) < 65536)) { if ( get_err ) { * err = strpprintf ( 0 , ""Invalid port value \\""%s\\"""" , str ) ; } return NULL; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { //check if the port is valid if (!(atoi(colon + 1) > 0 && atoi(colon + 1) < 65536)) { if ( get_err ) { * err = strpprintf ( 0 , ""Invalid port value \\""%s\\"""" , str ) ; } return NULL; } * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",439,-31.73470832676773,-0.07228862944594017
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { //Check if the port number is valid and in the range of 0-65535 if (atoi(colon + 1) < 0 || atoi(colon + 1) > 65535) { if ( get_err ) { * err = strpprintf ( 0 , ""Port number %d is not valid"" , atoi(colon + 1)) ; } return NULL ; } * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",383,-33.386308128782815,-0.08717051730752694
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } #endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { if (!isdigit(*(colon + 1))) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",351,-19.062100323508385,-0.05430797812965352
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; 

// Validate the IPv6 address before parsing 
if ( ! validateIPv6Address ( str ) ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } 

if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; } 

// Function to validate IPv6 address 
int validateIPv6Address ( char * str ) { 
    // Code to validate the IPv6 address 
}",408,-44.72999362444801,-0.10963233731482354
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","

static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } if (!is_valid_port(p + 2)) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { if (!is_valid_port(colon + 1)) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }

// Added function to check if the port being parsed is valid
bool is_valid_port(char *port) {
  int portno = atoi(port);
  if (portno <= 0 || portno > 65535) {
    return false;
  }
  return true;
}",475,-37.78639402894021,-0.07955030321882149
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; if (*portno > 0 && *portno < 65535){ // added code to check if port number is in range host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; }  } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",367,-33.595166552538736,-0.09153996335841617
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } if (! isValidPort(p + 2)) { if ( get_err ) { * err = strpprintf ( 0 , ""Invalid port number in IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { if (! isValidPort(colon + 1)) { if ( get_err ) { * err = strpprintf ( 0 , ""Invalid port number in address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; } 

bool isValidPort(char* portNo) {
  int portNumber = atoi(portNo);
  return (portNumber > 0 && portNumber < 65536);
}",443,-33.34391506435102,-0.07526843129650344
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; // Check for port ranges if( *portno > 65535 || *portno < 0) { if(get_err) { *err = strpprintf(0, ""Failed to parse address \\""%s\\"", port out of range"", str); } return NULL; } return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; // Check for port ranges if( *portno > 65535 || *portno < 0) { if(get_err) { *err = strpprintf(0, ""Failed to parse address \\""%s\\"", port out of range"", str); } return NULL; } host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",423,-34.57510354703218,-0.08173783344452051
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } if ( ! ( strlen ( p + 2 ) > 0 && isdigit ( ( unsigned char ) ( p + 2 ) [ 0 ] ) ) ) { // Validate input to ensure it is a valid port number return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { if ( ! ( strlen ( colon + 1 ) > 0 && isdigit ( ( unsigned char ) ( colon + 1 ) [ 0 ] ) ) ) { // Validate input to ensure it is a valid port number return NULL ; } * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",397,-41.588593711655726,-0.1047571630016517
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } if(!isdigit(*(p+2))){ if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { if(!isdigit(*(colon+1))){ if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",404,-10.89706302488049,-0.026972928279407154
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { 
	char * colon ; 
	char * host = NULL ; 
	# ifdef HAVE_IPV6 
	char * p ; 
	if ( * ( str ) == '[' && str_len > 1 ) { 
		p = memchr ( str + 1 , ']' , str_len - 2 ) ; 
		if ( ! p || * ( p + 1 ) != ':' ) { 
			if ( get_err ) { 
				* err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; 
			} 
			return NULL ; 
		} 
		if (atoi(p+2) < 1 || atoi(p+2) > 65535) {
			if (get_err) {
				*err = strpprintf(0, ""Port number must be between 1 and 65535. \\""%s\\"" is invalid"", str);
			}
			return NULL;
		}
		* portno = atoi ( p + 2 ) ; 
		return estrndup ( str + 1 , p - str - 1 ) ; 
	} 
	# endif 
	if ( str_len ) { 
		colon = memchr ( str , ':' , str_len - 1 ) ; 
	} else { 
		colon = NULL ; 
	} 
	if ( colon ) { 
		if (atoi(colon+1) < 1 || atoi(colon+1) > 65535) {
			if (get_err) {
				*err = strpprintf(0, ""Port number must be between 1 and 65535. \\""%s\\"" is invalid"", str);
			}
			return NULL;
		}
		* portno = atoi ( colon + 1 ) ; 
		host = estrndup ( str , colon - str ) ; 
	} else { 
		if ( get_err ) { 
			* err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; 
		} 
		return NULL ; 
	} 
	return host ; 
}",604,-28.746137062910254,-0.047592942157136185
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } if ( ! isValidPort ( atoi ( p + 2 ) ) ) //Added line to validate port * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { if ( ! isValidPort ( atoi ( colon + 1 ) ) ) //Added line to validate port * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; } 

//Added function
bool isValidPort ( int portno ) { 
  //Check if port number is valid 
  if ( portno > 0 && portno < 65536 ) { 
    return true ; 
  } 
  return false ; 
}",407,-46.63362527769894,-0.11457893188623818
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; if(*portno < 0 || *portno > 65535) { if ( get_err ) { * err = strpprintf ( 0 , ""Port number out of range \\""%d\\"""" , *portno ) ; } return NULL ; } return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; if(*portno < 0 || *portno > 65535) { if ( get_err ) { * err = strpprintf ( 0 , ""Port number out of range \\""%d\\"""" , *portno ) ; } return NULL ; } host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",409,-14.636834495318706,-0.0357868814066472
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } //Validate the port number if(atoi(p+2) >= 0 && atoi(p+2) < 65535) { * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { //Validate the port number if(atoi(colon+1) >= 0 && atoi(colon+1) < 65535) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }

In the fixed code, checks have been added to ensure that the port number is valid (between 0 and 65535) before it is parsed and used. This prevents malicious actors from exploiting the code to make requests to unexpected locations.",492,-56.838546589978044,-0.11552550119914237
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; if(*portno > 65535 || *portno < 0) { if ( get_err ) { * err = strpprintf ( 0 , ""Invalid port number \\""%s\\"""" , p + 2 ) ; } return NULL ; } return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; if(*portno > 65535 || *portno < 0) { if ( get_err ) { * err = strpprintf ( 0 , ""Invalid port number \\""%s\\"""" , colon + 1 ) ; } return NULL ; } host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",406,-14.507496506715292,-0.035732750016540124
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } if (atoi (p + 2) > 0 && atoi(p + 2) < 65536) { * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } else { return NULL; } } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { if (atoi (colon + 1) > 0 && atoi(colon + 1) < 65536){ * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { return NULL; } } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",362,-19.584110074502973,-0.05409975158702479
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { //Add check to see if port number is within valid range of 0-65535 if( *portno > 65535 || *portno < 0 ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",359,-37.20944402234391,-0.10364747638535908
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; if(strlen(str + 1) > 8 && str_len < 1024) //Check for valid size of IPv6 address { return estrndup ( str + 1 , p - str - 1 ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",370,-39.26080868725216,-0.10611029374933016
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; if (str_len > 2) { return estrndup ( str + 1 , p - str - 1 ) ; } else { return NULL; } } # endif 
if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; if (strlen(str) > 1) { host = estrndup ( str , colon - str ) ; } else { return NULL; } } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",335,-27.807277757384348,-0.08300679927577417
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; //Check if port number is valid if (*portno < 0 || *portno > 65535) { if ( get_err ) { * err = strpprintf ( 0 , ""Port number not valid \\""%s\\"""" , str ) ; } return NULL ; } return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; //Check if port number is valid if (*portno < 0 || *portno > 65535) { if ( get_err ) { * err = strpprintf ( 0 , ""Port number not valid \\""%s\\"""" , str ) ; } return NULL ; } host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",417,-18.638333742448026,-0.04469624398668592
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } if(check_valid_port(p + 2)){ * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { if(check_valid_port(colon + 1)){ * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }

int check_valid_port(char *port){
	int port_num = atoi(port);
	if(port_num > 0 && port_num < 65535){
		return 1;
	}
	return 0;
}",467,-28.43843934213088,-0.06089601572190767
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," 

static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { 
	char * colon ; 
	char * host = NULL ; 

# ifdef HAVE_IPV6
	char * p ; 
	if ( * ( str ) == '[' && str_len > 1 ) { 
		p = memchr ( str + 1 , ']' , str_len - 2 ) ; 
		if ( ! p || * ( p + 1 ) != ':' ) { 
			if ( get_err ) { 
				* err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; 
			} 
			return NULL ; 
		} 
		* portno = atoi ( p + 2 ) ; 

		//Check for invalid characters in the IP address and return an error if any are found
		if(!is_valid_ipv6_address(str + 1, p - str - 1)) {
			if ( get_err ) { 
				* err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; 
			} 
			return NULL ; 
		}
		return estrndup ( str + 1 , p - str - 1 ) ; 
	} 
# endif
	if ( str_len ) { 
		colon = memchr ( str , ':' , str_len - 1 ) ; 
	} else { 
		colon = NULL ; 
	} 
	if ( colon ) { 
		* portno = atoi ( colon + 1 ) ; 

		//Check for invalid characters in the IP address and return an error if any are found
		if(!is_valid_ipv4_address(str, colon - str)) {
			if ( get_err ) { 
				* err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; 
			} 
			return NULL ; 
		}
		host = estrndup ( str , colon - str ) ; 
	} else { 
		if ( get_err ) { 
			* err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; 
		} 
		return NULL ; 
	} 
	return host ; 
} 

//Function to check if an IPv4 address is valid
bool is_valid_ipv4_address(const char *ip_addr, int addr_len)
{
    //Check for invalid characters in the IP address and return an error if any are found
    for(int i = 0; i < addr_len; i++) {
        if(!(isdigit(ip_addr[i]) || ip_addr[i] == '.')) {
            return false;
        }
    }
    return true;
}

//Function to check if an IPv6 address is valid
bool is_valid_ipv6_address(const char *ip_addr, int addr_len)
{
    //Check for invalid characters in the IP address and return an error if any are found
    for(int i = 0; i < addr_len; i++) {
        if(!(isxdigit(ip_addr[i]) || ip_addr[i] == ':')) {
            return false;
        }
    }
    return true;
}",880,-88.9833997006026,-0.10111749965977569
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; if (*portno <= 0 || *portno > 65535) { if (get_err) { *err = strpprintf(0, ""Invalid port number \\""%s\\"""" , str); } return NULL; } return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; if (*portno <= 0 || *portno > 65535) { if (get_err) { *err = strpprintf(0, ""Invalid port number \\""%s\\"""" , str); } return NULL; } host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",399,-12.207845160890795,-0.030596103160127307
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } #endif if ( str_len ) { //Validation added here colon = memchr ( str , ':' , str_len - 1 ) ; if(colon && colon != str && (colon - str) > 2 && (colon - str) < 7) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",360,-48.126501964483076,-0.13368472767911965
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) {  char * colon ;  char * host = NULL ; # ifdef HAVE_IPV6 char * p ; 
if ( * ( str ) == '[' && str_len > 1 ) {  p = memchr ( str + 1 , ']' , str_len - 2 ) ;  if ( ! p || * ( p + 1 ) != ':' ) {  if ( get_err ) {  * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ;  }  return NULL ;  }  * portno = atoi ( p + 2 ) ; 
if (atoi(p + 2) < 1 || atoi(p + 2) > 65535) {  if ( get_err ) {  * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ;  }  return NULL ;  } 
return estrndup ( str + 1 , p - str - 1 ) ;  }  # endif if ( str_len ) {  colon = memchr ( str , ':' , str_len - 1 ) ;  } else {  colon = NULL ;  }  if ( colon ) {  * portno = atoi ( colon + 1 ) ; 
if (atoi(colon + 1) < 1 || atoi(colon + 1) > 65535) {  if ( get_err ) {  * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ;  }  return NULL ;  } 
host = estrndup ( str , colon - str ) ;  } else {  if ( get_err ) {  * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ;  }  return NULL ;  }  return host ; }",474,-38.52010590825933,-0.0812660462199564
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," 
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } if (atoi ( p + 2 ) <= 65535) { * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { if (atoi ( colon + 1 ) <= 65535) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",413,-14.956484034097057,-0.036214247055925075
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; // add check for loopback ip if(strcmp(str + 1, ""127.0.0.1"") == 0) { return NULL; // if loopback ip found, return null } return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; // add check for loopback ip if(strcmp(str, ""127.0.0.1"") == 0) { return NULL; // if loopback ip found, return null } host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",382,-45.25766050692192,-0.11847555106524063
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; if ( * portno > 0 && * portno < 65536 ) { return estrndup ( str + 1 , p - str - 1 ) ; } else { return NULL ; } } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; if ( * portno > 0 && * portno < 65536 ) { host = estrndup ( str , colon - str ) ; } else { return NULL ; } } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",345,-11.368648107700194,-0.0329526032107252
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' || ! is_valid_ipv6_address ( str )) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; if (! is_valid_ip_address ( str )) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }

The above code fixes the vulnerability by verifying that the IP address is valid before attempting to parse it. It does this by adding calls to two helper functions is_valid_ipv6_address() and is_valid_ip_address(). These functions should check that the IP address is in the correct format and is not a malicious URL designed to exploit the SSRF vulnerability.",441,-68.33937864621004,-0.1549645774290477
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ;  #ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; if (*portno > 0 && *portno < 65536) { return estrndup ( str + 1 , p - str - 1 ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; if (*portno > 0 && *portno < 65536) { host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",411,-18.649758777442358,-0.045376542037572645
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } //Check if the port number is valid if(atoi(p+2)<=65535 && atoi(p+2)>=1){ * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } else{ if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"" Invalid port number"" , str ) ; } return NULL ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { //Check if the port number is valid if(atoi(colon+1)<=65535 && atoi(colon+1)>=1){ * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else{ if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"" Invalid port number"" , str ) ; } return NULL ; } } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",459,-30.800650086092553,-0.06710381282373105
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { // Check for any characters other than ':' and digits and return if found for(int i = 0; i < str_len; i++){ if(str[i] != ':' && !isdigit(str[i])){ if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL; } } colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",391,-38.60343876383646,-0.09873002241390398
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; char * pattern = ""^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]):[0-9]+$"" ; regex_t regex ; if ( regcomp ( & regex , pattern , 0 ) ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse regex pattern \\""%s\\"""" , str ) ; } return NULL ; } # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; if ( regexec ( & regex , str , 0 , NULL , 0 ) == 0 ) { host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",525,-36.1186963723231,-0.06879751689966304
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:","
static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { //Check if the port number is valid. if(atoi(colon + 1) > 0 && atoi(colon + 1) < 65535) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Invalid port number \\""%s\\"""" , str ) ; } } } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",371,-27.80198502866474,-0.07493796503683219
"The Original Code is vulnerable to CWE-918: Server-Side Request Forgery (SSRF). Fix the vulnerability.
Original Code: static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }
Fixed code:"," static inline char * parse_ip_address_ex ( const char * str , size_t str_len , int * portno , int get_err , zend_string * * err ) { char * colon ; char * host = NULL ; # ifdef HAVE_IPV6 char * p ; if ( * ( str ) == '[' && str_len > 1 ) { p = memchr ( str + 1 , ']' , str_len - 2 ) ; if ( ! p || * ( p + 1 ) != ':' ) { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } * portno = atoi ( p + 2 ) ; struct in6_addr ip; if(inet_pton(AF_INET6, str + 1, &ip) != 1){ if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv6 address \\""%s\\"""" , str ) ; } return NULL ; } return estrndup ( str + 1 , p - str - 1 ) ; } # endif if ( str_len ) { colon = memchr ( str , ':' , str_len - 1 ) ; } else { colon = NULL ; } if ( colon ) { * portno = atoi ( colon + 1 ) ; host = estrndup ( str , colon - str ) ; } else { if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse address \\""%s\\"""" , str ) ; } return NULL ; } struct in_addr ip; if(inet_pton(AF_INET, host, &ip) != 1){ if ( get_err ) { * err = strpprintf ( 0 , ""Failed to parse IPv4 address \\""%s\\"""" , str ) ; } return NULL ; } return host ; }",433,-25.80943178113139,-0.05960607801646972
