Original code,Plausible Program,Total Tokens,Sum Entropy,Mean Entropy
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; //check if passed dentry is valid if (dentry == NULL || upperdir == NULL || upper == NULL) { err = -EINVAL; return err; } inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",248,-25.906257108171978,-0.10446071414585476
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper && upper-> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",214,-4.684797200883448,-0.02189157570506284
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if(upperdir == NULL || upper == NULL) { return - EINVAL; } inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",231,-12.448745167576348,-0.05389067172110973
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if ( upper == NULL || upper->d_parent != upperdir ) { return -ESTALE; } inode_lock_nested ( dir , I_MUTEX_PARENT ) ; dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",215,-8.611235732914595,-0.040052259222858586
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if ( upper == NULL )  return -ENOENT; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",225,-12.758437133703804,-0.05670416503868358
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if (!dentry || !dentry->d_parent || !upperdir || !dir || !upper) { return -EINVAL; } inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",243,-8.538347557949233,-0.03513723274876228
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { 
	if (dentry == NULL || dentry->d_parent == NULL) {
		return -EBADF;
	}
	
	struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; 
	struct inode * dir = upperdir -> d_inode ; 
	struct dentry * upper = ovl_dentry_upper ( dentry ) ; 
	int err ; 
	inode_lock_nested ( dir , I_MUTEX_PARENT ) ; 
	err = - ESTALE ; 
	if ( upper -> d_parent == upperdir ) { 
		dget ( upper ) ; 
		if ( is_dir ) 
			err = vfs_rmdir ( dir , upper ) ; 
		else 
			err = vfs_unlink ( dir , upper , NULL ) ; 
		
		dput ( upper ) ; 
		ovl_dentry_version_inc ( dentry -> d_parent ) ; 
	} 
	if ( ! err ) 
		d_drop ( dentry ) ; 
	inode_unlock ( dir ) ; 
	return err ; 
}",317,-24.305481901945683,-0.07667344448563307
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { 
if (!dentry || !dentry->d_parent || !dentry->d_parent->d_inode) {
return -ESTALE;
}
  
struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; 
struct inode * dir = upperdir -> d_inode ; 
struct dentry * upper = ovl_dentry_upper ( dentry ) ; 
int err ; 
inode_lock_nested ( dir , I_MUTEX_PARENT ) ; 
err = - ESTALE ; 
if ( upper -> d_parent == upperdir ) { 
dget ( upper ) ; 
if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; 
else err = vfs_unlink ( dir , upper , NULL ) ; 
dput ( upper ) ; 
ovl_dentry_version_inc ( dentry -> d_parent ) ; 
} 
if ( ! err ) d_drop ( dentry ) ; 
inode_unlock ( dir ) ; 
return err ; 
}",284,-22.36308226794841,-0.07874324742235356
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { if ( ! dentry || ! upperdir || ! dir || ! upper || ! is_dir ) { err = - EINVAL ; } else { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",245,-20.56969431704229,-0.08395793598792772
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if (!dentry || !upper) { return -EINVAL; } inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",228,-7.846555836272436,-0.034414718580142264
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if (!dentry || !upperdir || !dir || !upper) { return -ESTALE; } inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",234,-8.18904673128949,-0.03499592620209184
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper && upper-> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",214,-4.684797200883448,-0.02189157570506284
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { 

if (dentry == NULL) return -ESTALE;

struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; 
struct inode * dir = upperdir -> d_inode ; 
struct dentry * upper = ovl_dentry_upper ( dentry ) ; 
int err ; 
inode_lock_nested ( dir , I_MUTEX_PARENT ) ; 

err = - ESTALE ; 
if ( upper -> d_parent == upperdir ) { 
    dget ( upper ) ; 
    if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; 
    else err = vfs_unlink ( dir , upper , NULL ) ; 
    dput ( upper ) ; 
    ovl_dentry_version_inc ( dentry -> d_parent ) ; 
} 
if ( ! err ) d_drop ( dentry ) ; 
inode_unlock ( dir ) ; 
return err ; 
}",267,-20.211305244979368,-0.07569777245310624
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; 

if(upperdir->d_inode == NULL){
    return -ESTALE;
}

inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",238,-15.500284366050533,-0.06512724523550643
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper && upper-> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",214,-4.690220201399051,-0.021916916828967528
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { 
	struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; 
	struct inode * dir = upperdir -> d_inode ; 
	struct dentry * upper = ovl_dentry_upper ( dentry ) ; 
	int err ; 
	char *name = dentry->d_name.name;
	
	if(strlen(name) > 256)
		return -ENAMETOOLONG;
		
	inode_lock_nested ( dir , I_MUTEX_PARENT ) ; 
	err = - ESTALE ; 
	if ( upper -> d_parent == upperdir ) { 
		dget ( upper ) ; 
		if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; 
		else err = vfs_unlink ( dir , upper , NULL ) ; 
		dput ( upper ) ; 
		ovl_dentry_version_inc ( dentry -> d_parent ) ; 
	} 
	if ( ! err ) d_drop ( dentry ) ; 
	inode_unlock ( dir ) ; 
	return err ; 
}",310,-27.727543526275475,-0.08944368879443702
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if ( upper == NULL ) { err = -EINVAL; } else { inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; } return err ; }",230,-9.996355344606295,-0.0434624145417665
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { if ( strcmp ( upper -> d_name . name , dentry -> d_name . name ) == 0 ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } else { err = -EBADF ; } } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",249,-22.541855726784323,-0.09052954107142298
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if ( upperdir == NULL || upper == NULL ) return -EINVAL; 
inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",231,-11.394275150881233,-0.049325866454031315
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; 
//Check if the input dentry is valid 
if(dentry == NULL){
	return -EINVAL;
}

inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",244,-23.74698118573239,-0.09732369338414915
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper->d_parent == upperdir && dir->i_op && dir->i_op->rmdir && (dir->i_op->rmdir == vfs_rmdir) && dir->i_op->unlink && (dir->i_op->unlink == vfs_unlink) ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",273,-22.88674018387855,-0.08383421312776027
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if ( upper -> d_parent != upperdir ) { return -ESTALE; } inode_lock_nested ( dir , I_MUTEX_PARENT ) ; dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",211,-9.032177240077239,-0.04280652720415753
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if(!upperdir || !dentry || !upper) return -ESTALE; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",230,-11.828664374372696,-0.051428975540750856
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper->d_parent == upperdir && upper->d_inode != NULL) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",221,-8.8920759831746,-0.04023563793291674
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { 
if (!dentry) {
return -EINVAL;
}

struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; 
if (!upperdir) {
return -EINVAL;
}

struct inode * dir = upperdir -> d_inode ; 
if (!dir) {
return -EINVAL;
}

struct dentry * upper = ovl_dentry_upper ( dentry ) ; 
if (!upper) {
return -EINVAL;
}

int err ; 
inode_lock_nested ( dir , I_MUTEX_PARENT ) ; 
err = - ESTALE ; 
if ( upper -> d_parent == upperdir ) { 
dget ( upper ) ; 
if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; 
else err = vfs_unlink ( dir , upper , NULL ) ; 
dput ( upper ) ; 
ovl_dentry_version_inc ( dentry -> d_parent ) ; 
} 
if ( ! err ) d_drop ( dentry ) ; 
inode_unlock ( dir ) ; 
return err ; 
}",312,-13.717697433216282,-0.04396697895261629
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper && upper-> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",214,-4.7408074569051575,-0.022153305873388585
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper && upper-> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",214,-4.744575620450984,-0.022170914114256934
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if (!upper || !upper->d_parent) return -EINVAL; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",229,-10.49412470623997,-0.045825872079650526
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if ( upper -> d_parent != upperdir ) { return - ESTALE; } inode_lock_nested ( dir , I_MUTEX_PARENT ) ; dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",211,-9.752489234814956,-0.0462203281270851
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if (upperdir == NULL || upper == NULL) { return - ESTALE; } inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",230,-9.784316982232717,-0.04254050861840312
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; err = - ESTALE ; if(!upperdir || !upper || !dir) return err; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",233,-16.690014705944396,-0.07163096440319483
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if (!dentry || !upperdir || !dir || !upper) { return -EINVAL; } inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",235,-6.3276796024790665,-0.026926296180761984
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { if ( dentry == NULL || dentry -> d_parent == NULL ) return - ESTALE ; struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ;  if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } else err = - ESTALE ; if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",235,-19.038920895983868,-0.08101668466376113
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if ( upper == NULL ) { return - ESTALE ; } inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",225,-7.910970614156936,-0.03515986939625305
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if (!dentry || !upperdir || !dir || !upper) return -EINVAL; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",233,-6.279653543771957,-0.02695130276296977
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","

static int ovl_remove_upper(struct dentry *dentry, bool is_dir) {
    struct dentry *upperdir = ovl_dentry_upper(dentry->d_parent);
    struct inode *dir = upperdir->d_inode;
    struct dentry *upper = ovl_dentry_upper(dentry);
    int err;

    if (upper == NULL || upper->d_parent != upperdir) {
        return -ESTALE;
    }
    inode_lock_nested(dir, I_MUTEX_PARENT);
    dget(upper);
    if (is_dir) 
        err = vfs_rmdir(dir, upper);
    else 
        err = vfs_unlink(dir, upper, NULL);
    dput(upper);
    ovl_dentry_version_inc(dentry->d_parent);
    if (!err) 
        d_drop(dentry);
    inode_unlock(dir);
    return err;
}",247,-16.409212184013796,-0.06643405742515707
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if (dentry == NULL || dentry->d_parent == NULL || upper == NULL || upper->d_parent == NULL) { return -EINVAL; } inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",248,-10.947440690074197,-0.0441429060083637
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { 
	struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; 
	struct inode * dir = upperdir -> d_inode ; 
	struct dentry * upper = ovl_dentry_upper ( dentry ) ; 
	int err ; 
	
	inode_lock_nested ( dir , I_MUTEX_PARENT ) ; 
	if (!upper || upper->d_parent != upperdir) {
		err = -ESTALE;
	} else {
		dget ( upper ) ; 
		if ( is_dir ) 
			err = vfs_rmdir ( dir , upper ) ; 
		else 
			err = vfs_unlink ( dir , upper , NULL ) ; 
		dput ( upper ) ; 
		ovl_dentry_version_inc ( dentry -> d_parent ) ; 
	} 
	if ( ! err ) 
		d_drop ( dentry ) ; 
	inode_unlock ( dir ) ; 
	return err ; 
}",289,-18.57856645331528,-0.06428569707029508
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:"," 
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; 

// Add input validation
if (dentry == NULL || upperdir == NULL || dir == NULL || upper == NULL)
    return -EINVAL;

inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",251,-16.22317071942998,-0.06463414629254972
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent != upperdir ) { err = -EINVAL; } else { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",222,-8.104494855608142,-0.03650673358382046
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) {
    struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ;
    struct inode * dir = upperdir -> d_inode ;
    struct dentry * upper = ovl_dentry_upper ( dentry ) ;
    int err ;

    if (upper == NULL) {
        return -EINVAL;
    }

    inode_lock_nested ( dir , I_MUTEX_PARENT ) ;
    err = - ESTALE ;
    if ( upper -> d_parent == upperdir ) {
        dget ( upper ) ;
        if ( is_dir ) 
            err = vfs_rmdir ( dir , upper ) ;
        else 
            err = vfs_unlink ( dir , upper , NULL ) ;
        dput ( upper ) ;
        ovl_dentry_version_inc ( dentry -> d_parent ) ;
    }
    if ( ! err ) 
        d_drop ( dentry ) ;
    inode_unlock ( dir ) ;
    return err ;
}",274,-19.301513444919202,-0.07044347972598249
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir && ! d_is_negative ( upper ) ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; } 
The code has been modified by adding a check to ensure that the dentry represented by 'upper' is not negative. This check will help to validate the input and reduce the risk of improper input validation.",265,-46.744502033313985,-0.17639434729552447
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; if (upper == NULL) { err = - EINVAL; } else { err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; } return err ; }",230,-13.375942693485454,-0.05815627258037154
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","

static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if ( upper == NULL ) return -ENOENT; if(strlen(upper->d_name) > NAME_MAX) return -ENAMETOOLONG; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",249,-20.995323423589205,-0.08431856796622171
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ;  
err = - ESTALE ; 
if ( upper-> d_parent == upperdir && upper-> d_inode != NULL ) {
	dget ( upper ) ; 
	if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; 
	else err = vfs_unlink ( dir , upper , NULL ) ; 
	dput ( upper ) ; 
	ovl_dentry_version_inc ( dentry -> d_parent ) ; 
} 
if ( ! err ) d_drop ( dentry ) ; 
inode_unlock ( dir ) ; 
return err ; 
}",249,-30.280546909796985,-0.12160862212769874
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { if ( dentry == NULL || ovl_dentry_upper ( dentry -> d_parent ) == NULL ) { return - ESTALE ; } struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",244,-10.686485758356286,-0.04379707278014871
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) {
if (!dentry)
	return -ESTALE;

struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ;
if (!upperdir) 
	return -ESTALE;

struct inode * dir = upperdir -> d_inode ;
if (!dir) 
	return -ESTALE; 

struct dentry * upper = ovl_dentry_upper ( dentry ) ; 
if (!upper)
	return -ESTALE;

int err ; 
inode_lock_nested ( dir , I_MUTEX_PARENT ) ; 
err = - ESTALE ; 

if ( upper -> d_parent == upperdir ) {
	dget ( upper ) ; 
	if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; 
	else err = vfs_unlink ( dir , upper , NULL ) ; 
	dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; 
} 
if ( ! err ) d_drop ( dentry ) ; 
inode_unlock ( dir ) ; 
return err ; 
}",302,-42.563548455423046,-0.140938902170275
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:"," 

static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; if (!upperdir || !dir) {
  return -EINVAL;
}
inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",234,-18.49528555503371,-0.07903968185911842
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; 

if(is_dir && dentry == NULL && upper == NULL) {
    return -EINVAL;
}

inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }",243,-24.465721100630518,-0.10068197983798567
"The Original Code is vulnerable to CWE-20: Improper Input Validation. Fix the vulnerability.
Original Code:
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; struct inode * dir = upperdir -> d_inode ; struct dentry * upper = ovl_dentry_upper ( dentry ) ; int err ; inode_lock_nested ( dir , I_MUTEX_PARENT ) ; err = - ESTALE ; if ( upper -> d_parent == upperdir ) { dget ( upper ) ; if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; else err = vfs_unlink ( dir , upper , NULL ) ; dput ( upper ) ; ovl_dentry_version_inc ( dentry -> d_parent ) ; } if ( ! err ) d_drop ( dentry ) ; inode_unlock ( dir ) ; return err ; }
Fixed code:","
static int ovl_remove_upper ( struct dentry * dentry , bool is_dir ) { 
  struct dentry * upperdir = ovl_dentry_upper ( dentry -> d_parent ) ; 
  struct inode * dir = upperdir -> d_inode ; 
  struct dentry * upper = ovl_dentry_upper ( dentry ) ; 
  int err ; 
  inode_lock_nested ( dir , I_MUTEX_PARENT ) ; 
  err = - ESTALE ; 
  if ( upper-> d_parent == upperdir && !strchr ( upper -> d_name . name , '\n' )) { 
    dget ( upper ) ; 
    if ( is_dir ) err = vfs_rmdir ( dir , upper ) ; 
    else err = vfs_unlink ( dir , upper , NULL ) ; 
    dput ( upper ) ; 
    ovl_dentry_version_inc ( dentry -> d_parent ) ; 
  } 
  if ( ! err ) d_drop ( dentry ) ; 
  inode_unlock ( dir ) ; 
  return err ; 
}",280,-29.519337448882002,-0.10542620517457858
