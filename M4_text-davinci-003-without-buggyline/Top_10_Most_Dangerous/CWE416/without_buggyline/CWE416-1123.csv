Original code,Plausible Program,Total Tokens,Sum Entropy,Mean Entropy
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; } else { spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; } return peer ; }",151,-4.2501050423048,-0.02814639100864106
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } else { rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } return peer ; }",151,-3.8903853661087004,-0.02576414149740861
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; } rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return NULL ; }",151,-4.57825320269595,-0.030319557633748013
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; synchronize_rcu ( ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",130,-3.7048725701861005,-0.028499019770662312
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; } else { peer = NULL; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",129,-6.0392408222098,-0.046815820327207755
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; } else { peer = NULL; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",129,-6.038023472230201,-0.04680638350566047
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return NULL ; }",151,-3.2538525966901797,-0.021548692693312447
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { __get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return NULL ; }",152,-9.20210560053895,-0.060540168424598355
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; if ( ! idr_find ( & net -> netns_ids , id ) ) { rcu_read_unlock ( ) ; return NULL ; } spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",154,-11.3513710493228,-0.07371020161897922
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return NULL ; }",151,-3.257693668195401,-0.021574130252949675
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; atomic_inc( & peer -> refcnt ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",134,-6.934340448189941,-0.051748809314850305
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; synchronize_rcu ( ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",130,-3.7048725701861005,-0.028499019770662312
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; } else { rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return NULL ; } }",154,-4.565490215619802,-0.029646040361167542
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return NULL ; }",151,-3.257693668195401,-0.021574130252949675
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } return peer ; }",122,-4.031184555537701,-0.0330424963568664
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id(struct net *net, int id) { 
    struct net *peer; 
    if (id < 0) 
        return NULL; 
    rcu_read_lock(); 
    spin_lock_bh(&net->nsid_lock); 
    peer = idr_find(&net->netns_ids, id); 
    if (peer) 
        atomic_inc(&peer->use_count); 
    spin_unlock_bh(&net->nsid_lock); 
    rcu_read_unlock(); 
    return peer; 
}
The vulnerability in the original code is that the reference count is not incremented when the peer is found. This can lead to a use-after-free situation, as the peer can be freed before the reference count is incremented. 

The fixed code addresses the issue by using the atomic_inc() function to increment the reference count of the peer when it is found, thus ensuring that the peer remains valid until the reference count reaches 0.",240,-70.6599542157855,-0.29441647589910624
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; if (peer) { synchronize_net(); put_net(peer); } return peer ; }",137,-9.924482500373502,-0.07244147810491608
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } else { rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } return peer ; }",151,-3.7637754926249984,-0.024925665514072836
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; }",122,-3.3198680176810003,-0.02721203293181148
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; // Added this line to increment the net refcount spin_unlock_bh ( & net -> nsid_lock ) ; } rcu_read_unlock ( ) ; return peer ; }",132,-23.279760640972395,-0.17636182303766965
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; if ( peer ) rcu_read_unlock ( ) ; return peer ; }",124,-7.526810018501101,-0.06070008079436372
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ;  rcu_read_unlock ( ) ; } else { spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; } return peer ; }",136,-10.129207987123799,-0.07447947049355734
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) atomic_inc( &peer->refcnt ); spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",124,-7.424501649729604,-0.059875013304270995
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; synchronize_rcu ( ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",130,-3.710623876453501,-0.028543260588103855
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; } else { peer = NULL; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",129,-6.101052369057898,-0.047294979605099985
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; }",122,-3.2891483112762,-0.026960232059640984
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; // Add reference to the net object so that it is not freed prematurely rcu_read_unlock ( ) ; // Release the read lock before returning the net object } else { rcu_read_unlock ( ) ; // Release the read lock if the net object was not found } spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; }",171,-34.6065975044173,-0.2023777631837269
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return NULL ; }    
The code has been updated to make sure the locks are unlocked before returning from the function. This prevents the use-after-free vulnerability.",181,-37.86692110397214,-0.2092095088617245
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } else { rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } return peer ; }",151,-3.7537567796600997,-0.024859316421590064
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; atomic_inc ( & peer -> refcnt ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",134,-4.750879683381701,-0.035454325995385824
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } else { rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; peer = NULL ; } return peer ; }",155,-5.140370985470101,-0.033163683777226456
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } else { rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return NULL ; } return peer ; }",154,-4.493678393264999,-0.0291797298263961
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return NULL ; }",151,-3.2532312883965013,-0.021544578068851003
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; } else { spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return NULL ; } }",154,-4.416257801032301,-0.028676998708001954
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; }",122,-3.3268568075993996,-0.027269318095077048
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; if ( peer ) put_net ( peer ) ; return peer ; }",131,-4.3442221433813994,-0.0331620010945145
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } else rcu_read_unlock ( ) ; return peer ; }",133,-6.259248369698101,-0.04706201781727896
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return NULL ; }",151,-3.2532312883965013,-0.021544578068851003
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; atomic_inc ( & peer -> use_count ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",134,-7.0304462626039,-0.05246601688510373
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } return peer ; }",122,-3.9015134192167,-0.03197961819030082
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; synchronize_rcu ( ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",130,-3.6815607539783994,-0.02831969810752615
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; return peer ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return NULL ; }",151,-3.2532312883965013,-0.021544578068851003
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer = NULL ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; if ( peer ) put_net ( peer ) ; return peer ; }",133,-6.206201728743802,-0.046663170892810545
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; synchronize_rcu ( ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",130,-3.686468712190801,-0.028357451632236932
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; synchronize_rcu ( ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",130,-3.6815607539783994,-0.02831969810752615
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; atomic_inc ( & peer -> refcount ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",133,-5.659035380016299,-0.04254913819561127
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) atomic_inc(&peer->refcnt); spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",123,-6.667532017151601,-0.05420757737521627
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } else { spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; } return peer ; }",151,-4.167978877385899,-0.027602509121760918
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; atomic_inc ( & peer -> refcount ) ; } spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }",133,-5.586666662978899,-0.04200501250360074
"The Original Code is vulnerable to CWE-416: Use After Free. Fix the vulnerability.
Original Code:
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) get_net ( peer ) ; spin_unlock_bh ( & net -> nsid_lock ) ; rcu_read_unlock ( ) ; return peer ; }
Fixed code:","
struct net * get_net_ns_by_id ( struct net * net , int id ) { struct net * peer ; if ( id < 0 ) return NULL ; rcu_read_lock ( ) ; spin_lock_bh ( & net -> nsid_lock ) ; peer = idr_find ( & net -> netns_ids , id ) ; if ( peer ) { get_net ( peer ) ; rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } else { rcu_read_unlock ( ) ; spin_unlock_bh ( & net -> nsid_lock ) ; } return peer ; }",151,-3.8498544240403,-0.02549572466251854
